// ...existing code...

// Place after $cs-pos-listening-top is defined
/* Character sheet specific styles extracted from templates/actors/character-sheet.html
   Migrate presentation out of the template and into this partial. */

/* ================================================================
   DEBUG CONFIGURATION
   ================================================================
   
   Uncomment the sections below to enable visual debugging for specific
   components. These should be commented out in production.
   
   ================================================================ */

/* Form Field Debug - Master Switch */
/* Uncomment the line below to enable red dashed borders on all form fields */
$debug-form-fields: false; // Change to false to disable

/* Form Field Debug - Controlled by $debug-form-fields variable */
@if $debug-form-fields {
  input, select, textarea, button {
    border: 0.5px dashed red !important;
  }
  
  /* Additional form field types */
  .cs-char-name,
  .cs-class-select,
  .cs-background-select,
  .cs-race-select,
  .cs-alignment-select,
  .cs-age-field,
  .cs-sex-field,
  .cs-height-field,
  .cs-weight-field,
  .char-height,
  .char-weight,
  .cs-languages-field,
  .languages-tags,
  .char-languages,
  .cs-input-small,
  .cs-input-medium,
  .cs-select-inline,
  .cs-listening-select,
  .cs-bio-textarea,
  .cs-ability-select,
  .attr-str,
  .attr-dex,
  .attr-con,
  .attr-int,
  .attr-wis,
  .attr-cha,
  .cs-save-value,
  .cs-save-badge,
  .cs-combat-input,
  .cs-portrait-img,
  .portrait-img,
  .cs-portrait-display,
  .portrait-display,
  .cs-level-display,
  .cs-xp-display,
  .cs-xp-mod-display {
    border: 0.5px dashed red !important;
  }
  
  /* High specificity rules for stubborn elements */
  .osp.sheet.actor.character {
    input[name*="height"],
    input[name*="weight"],
    input[name*="languages"],
    select[name*="attributes"],
    .attr-str,
    .attr-dex,
    .attr-con,
    .attr-int,
    .attr-wis,
    .attr-cha {
      border: 0.5px dashed red !important;
    }
  }
  
  /* Position Adjustment Dialog Styling */
  .cs-position-dialog {
    .form-group {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
      
      label {
        flex: 0 0 120px;
        color: #ddd;
        font-weight: 500;
        font-size: 12px;
      }
      
      input[type="number"] {
        flex: 1;
        padding: 6px 8px;
        border: 1px solid #555;
        border-radius: 4px;
        background: #333;
        color: #fff;
        font-size: 12px;
        margin-right: 8px;
        
        &:focus {
          border-color: #4CAF50;
          outline: none;
          box-shadow: 0 0 3px rgba(76, 175, 80, 0.3);
        }
      }
      
      .unit {
        color: #aaa;
        font-size: 11px;
        font-weight: 500;
        flex: 0 0 auto;
      }
    }
    
    h3 {
      color: #fff;
      margin-bottom: 15px;
      font-size: 14px;
      text-align: center;
      padding-bottom: 8px;
      border-bottom: 1px solid #555;
    }
  }
  
  /* Position Adjustment Tool - Clean, modern styling */
  .cs-position-tool {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    background: #2a2a2a !important;
    border: 2px solid #444 !important;
    border-radius: 8px !important;
    padding: 15px !important;
    color: #fff !important;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
    font-size: 12px !important;
    z-index: 99999 !important;
    min-width: 320px !important;
    max-width: 400px !important;
    max-height: 80vh !important;
    overflow-y: auto !important;
    box-shadow: 0 8px 32px rgba(0,0,0,0.8) !important;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    
    .tool-header {
      background: #333 !important;
      margin: -15px -15px 15px -15px !important;
      padding: 12px 15px !important;
      border-radius: 6px 6px 0 0 !important;
      border-bottom: 1px solid #555 !important;
      font-weight: bold !important;
      display: flex !important;
      justify-content: space-between !important;
      align-items: center !important;
      color: #fff !important;
      
      .close-btn {
        background: #e74c3c !important;
        color: white !important;
        border: none !important;
        border-radius: 3px !important;
        padding: 4px 8px !important;
        cursor: pointer !important;
        font-size: 12px !important;
        font-weight: bold !important;
        
        &:hover {
          background: #c0392b !important;
        }
      }
    }
    
    .tool-section {
      margin-bottom: 15px !important;
      
      .section-title {
        color: #bbb !important;
        margin-bottom: 8px !important;
        font-size: 11px !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
        font-weight: bold !important;
      }
      
      .controls {
        display: grid !important;
        grid-template-columns: 60px auto 60px 80px !important;
        gap: 8px !important;
        align-items: center !important;
        margin-bottom: 6px !important;
        
        .control-label {
          color: #ccc !important;
          font-weight: 500 !important;
        }
        
        .control-buttons {
          display: flex !important;
          gap: 4px !important;
          justify-content: center !important;
          
          button {
            background: #444 !important;
            color: #fff !important;
            border: 1px solid #666 !important;
            border-radius: 4px !important;
            padding: 6px 10px !important;
            cursor: pointer !important;
            font-size: 12px !important;
            font-weight: bold !important;
            min-width: 30px !important;
            
            &:hover {
              background: #555 !important;
              border-color: #777 !important;
            }
            
            &:active {
              background: #333 !important;
            }
          }
        }
        
        .control-input {
          background: #333 !important;
          color: #fff !important;
          border: 1px solid #666 !important;
          border-radius: 4px !important;
          padding: 6px 8px !important;
          font-size: 12px !important;
          width: 100% !important;
          text-align: center !important;
          
          &:focus {
            outline: none !important;
            border-color: #4CAF50 !important;
            background: #444 !important;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2) !important;
          }
        }
        
        .control-value {
          color: #4CAF50 !important;
          font-weight: bold !important;
          text-align: right !important;
          font-size: 12px !important;
        }
      }
    }
    
    .tool-footer {
      border-top: 1px solid #555 !important;
      padding-top: 12px !important;
      margin-top: 15px !important;
      text-align: center !important;
      display: flex !important;
      gap: 8px !important;
      justify-content: center !important;
      
      button {
        border: none !important;
        border-radius: 4px !important;
        padding: 8px 16px !important;
        cursor: pointer !important;
        font-size: 12px !important;
        font-weight: 500 !important;
        
        &:hover {
          transform: translateY(-1px) !important;
          box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }
      }
      
      .save-btn {
        background: #27ae60 !important;
        color: white !important;
        
        &:hover {
          background: #229954 !important;
        }
      }
      
      .reset-btn {
        background: #f39c12 !important;
        color: white !important;
        
        &:hover {
          background: #e67e22 !important;
        }
      }

      .toggle-btn {
        background: #2196F3 !important;
        color: white !important;
        
        &:hover {
          background: #1976D2 !important;
        }
      }
    }
  }
}

/* ================================================================
   END DEBUG CONFIGURATION
   ================================================================ */

/* Shared positioning variables */
$cs-header-row-top: 5px !default; // Shared y-coordinate for main header fields (Name, Class, Level, XP Mod)

/* Centralized position variables - change these to tweak sheet layout globally */
$cs-pos-level-left: 502px !default;
$cs-pos-level-top: 13px !default;
$cs-pos-portrait-left: 31px !default;
$cs-pos-portrait-top: 12px !default;
$cs-pos-languages-left: 437px !default;
$cs-pos-languages-top: 206px !default;
$cs-pos-xpmod-left: 694px !default;
$cs-pos-xpmod-top: 13px !default;
$cs-pos-xp-left: 608px !default;
$cs-pos-xp-top: 77px !default;
$cs-pos-next-left: 462px !default;
$cs-pos-next-top: 68px !default;

/* Additional header / field position presets discovered during sweep */
$cs-pos-namegroup-left: 263px !default;
$cs-pos-namegroup-top: 13px !default;
$cs-pos-class-left: 435px !default;
$cs-pos-class-top: 77px !default;
$cs-pos-alignment-left: 436px !default;
$cs-pos-alignment-top: 142px !default;
$cs-pos-race-left: 263px !default;
$cs-pos-race-top: 77px !default;
$cs-pos-age-left: 263px !default;
$cs-pos-age-top: 142px !default;
$cs-pos-sex-left: 352px !default;
$cs-pos-sex-top: 142px !default;
$cs-pos-height-left: 263px !default;
$cs-pos-height-top: 206px !default;
$cs-pos-weight-left: 350px !default;
$cs-pos-weight-top: 206px !default;
$cs-pos-background-left: 608px !default;
$cs-pos-background-top: 142px !default;
$cs-pos-listening-left: 381px !default;
$cs-pos-listening-top: 301px !default;
$cs-pos-listening-width: 58px !default;
$cs-pos-listening-height: 58px !default;
$cs-pos-find-secret-door-left: 268px !default;
$cs-pos-find-secret-door-top: 301px !default;
$cs-pos-find-secret-door-width: 58px !default;
$cs-pos-find-secret-door-height: 58px !default;
.cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left}; --top: #{$cs-pos-find-secret-door-top}; --width: #{$cs-pos-find-secret-door-width}; --height: #{$cs-pos-find-secret-door-height}; --z: var(--z-labels, 15); }
$cs-pos-open-stuck-doors-left: 155px !default;
$cs-pos-open-stuck-doors-top: 301px !default;
$cs-pos-open-stuck-doors-width: 58px !default;
$cs-pos-open-stuck-doors-height: 58px !default;
.cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left}; --top: #{$cs-pos-open-stuck-doors-top}; --width: #{$cs-pos-open-stuck-doors-width}; --height: #{$cs-pos-open-stuck-doors-height}; --z: var(--z-labels, 15); }
$cs-pos-detect-construction-left: 190px !default;
$cs-pos-detect-construction-top: 294px !default;
$cs-pos-detect-construction-width: 58px !default;
$cs-pos-detect-construction-height: 58px !default;
.cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left}; --top: #{$cs-pos-detect-construction-top}; --width: #{$cs-pos-detect-construction-width}; --height: #{$cs-pos-detect-construction-height}; --z: var(--z-labels, 15); }
$cs-pos-detect-room-traps-left: 256px !default;
$cs-pos-detect-room-traps-top: 294px !default;
$cs-pos-detect-room-traps-width: 58px !default;
$cs-pos-detect-room-traps-height: 58px !default;
.cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left}; --top: #{$cs-pos-detect-room-traps-top}; --width: #{$cs-pos-detect-room-traps-width}; --height: #{$cs-pos-detect-room-traps-height}; --z: var(--z-labels, 15); }
$cs-pos-barbarian-climb-left: 322px !default;
$cs-pos-barbarian-climb-top: 294px !default;
$cs-pos-barbarian-climb-width: 58px !default;
$cs-pos-barbarian-climb-height: 58px !default;
.cs-pos-barbarian-climb { --left: #{$cs-pos-barbarian-climb-left}; --top: #{$cs-pos-barbarian-climb-top}; --width: #{$cs-pos-barbarian-climb-width}; --height: #{$cs-pos-barbarian-climb-height}; --z: var(--z-labels, 15); }
$cs-pos-barbarian-hide-left: 388px !default;
$cs-pos-barbarian-hide-top: 294px !default;
$cs-pos-barbarian-hide-width: 58px !default;
$cs-pos-barbarian-hide-height: 58px !default;
.cs-pos-barbarian-hide { --left: #{$cs-pos-barbarian-hide-left}; --top: #{$cs-pos-barbarian-hide-top}; --width: #{$cs-pos-barbarian-hide-width}; --height: #{$cs-pos-barbarian-hide-height}; --z: var(--z-labels, 15); }
$cs-pos-barbarian-move-left: 454px !default;
$cs-pos-barbarian-move-top: 294px !default;
$cs-pos-barbarian-move-width: 58px !default;
$cs-pos-barbarian-move-height: 58px !default;
.cs-pos-barbarian-move { --left: #{$cs-pos-barbarian-move-left}; --top: #{$cs-pos-barbarian-move-top}; --width: #{$cs-pos-barbarian-move-width}; --height: #{$cs-pos-barbarian-move-height}; --z: var(--z-labels, 15); }

// Additional skill positioning variables for dynamic skills
$cs-pos-assassination-left: 100px !default;
$cs-pos-assassination-top: 294px !default;
$cs-pos-assassination-width: 58px !default;
$cs-pos-assassination-height: 58px !default;
.cs-pos-assassination { --left: #{$cs-pos-assassination-left}; --top: #{$cs-pos-assassination-top}; --width: #{$cs-pos-assassination-width}; --height: #{$cs-pos-assassination-height}; --z: var(--z-labels, 15); }

$cs-pos-climb-sheer-left: 200px !default;
$cs-pos-climb-sheer-top: 294px !default;
$cs-pos-climb-sheer-width: 58px !default;
$cs-pos-climb-sheer-height: 58px !default;
.cs-pos-climb-sheer { --left: #{$cs-pos-climb-sheer-left}; --top: #{$cs-pos-climb-sheer-top}; --width: #{$cs-pos-climb-sheer-width}; --height: #{$cs-pos-climb-sheer-height}; --z: var(--z-labels, 15); }

$cs-pos-hide-shadows-left: 300px !default;
$cs-pos-hide-shadows-top: 294px !default;
$cs-pos-hide-shadows-width: 58px !default;
$cs-pos-hide-shadows-height: 58px !default;
.cs-pos-hide-shadows { --left: #{$cs-pos-hide-shadows-left}; --top: #{$cs-pos-hide-shadows-top}; --width: #{$cs-pos-hide-shadows-width}; --height: #{$cs-pos-hide-shadows-height}; --z: var(--z-labels, 15); }

$cs-pos-move-silently-left: 400px !default;
$cs-pos-move-silently-top: 294px !default;
$cs-pos-move-silently-width: 58px !default;
$cs-pos-move-silently-height: 58px !default;
.cs-pos-move-silently { --left: #{$cs-pos-move-silently-left}; --top: #{$cs-pos-move-silently-top}; --width: #{$cs-pos-move-silently-width}; --height: #{$cs-pos-move-silently-height}; --z: var(--z-labels, 15); }

$cs-pos-find-traps-left: 500px !default;
$cs-pos-find-traps-top: 294px !default;
$cs-pos-find-traps-width: 58px !default;
$cs-pos-find-traps-height: 58px !default;
.cs-pos-find-traps { --left: #{$cs-pos-find-traps-left}; --top: #{$cs-pos-find-traps-top}; --width: #{$cs-pos-find-traps-width}; --height: #{$cs-pos-find-traps-height}; --z: var(--z-labels, 15); }

$cs-pos-open-locks-left: 150px !default;
$cs-pos-open-locks-top: 294px !default;
$cs-pos-open-locks-width: 58px !default;
$cs-pos-open-locks-height: 58px !default;
.cs-pos-open-locks { --left: #{$cs-pos-open-locks-left}; --top: #{$cs-pos-open-locks-top}; --width: #{$cs-pos-open-locks-width}; --height: #{$cs-pos-open-locks-height}; --z: var(--z-labels, 15); }

$cs-pos-pick-pockets-left: 250px !default;
$cs-pos-pick-pockets-top: 294px !default;
$cs-pos-pick-pockets-width: 58px !default;
$cs-pos-pick-pockets-height: 58px !default;
.cs-pos-pick-pockets { --left: #{$cs-pos-pick-pockets-left}; --top: #{$cs-pos-pick-pockets-top}; --width: #{$cs-pos-pick-pockets-width}; --height: #{$cs-pos-pick-pockets-height}; --z: var(--z-labels, 15); }

$cs-pos-hide-undergrowth-left: 350px !default;
$cs-pos-hide-undergrowth-top: 294px !default;
$cs-pos-hide-undergrowth-width: 58px !default;
$cs-pos-hide-undergrowth-height: 58px !default;
.cs-pos-hide-undergrowth { --left: #{$cs-pos-hide-undergrowth-left}; --top: #{$cs-pos-hide-undergrowth-top}; --width: #{$cs-pos-hide-undergrowth-width}; --height: #{$cs-pos-hide-undergrowth-height}; --z: var(--z-labels, 15); }

$cs-pos-hide-dungeons-left: 450px !default;
$cs-pos-hide-dungeons-top: 294px !default;
$cs-pos-hide-dungeons-width: 58px !default;
$cs-pos-hide-dungeons-height: 58px !default;
.cs-pos-hide-dungeons { --left: #{$cs-pos-hide-dungeons-left}; --top: #{$cs-pos-hide-dungeons-top}; --width: #{$cs-pos-hide-dungeons-width}; --height: #{$cs-pos-hide-dungeons-height}; --z: var(--z-labels, 15); }

/* Skill Target Position Variants - Adjusts positions based on race/class layout */
/* Class-based position adjustments (take priority over race) */
.skill-layout-assassin {
  /* Base skills - all races have these */
  .cs-pos-listening { --left: #{$cs-pos-listening-left - 20px}; }
  .cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left - 20px}; }
  .cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left - 20px}; }
  
  /* Assassin-specific skills */
  .cs-pos-assassination { --left: #{$cs-pos-assassination-left - 20px}; }
  .cs-pos-climb-sheer { --left: #{$cs-pos-climb-sheer-left - 20px}; }
  .cs-pos-hide-shadows { --left: #{$cs-pos-hide-shadows-left - 20px}; }
  .cs-pos-move-silently { --left: #{$cs-pos-move-silently-left - 20px}; }
  
  /* Skills that might be present from race */
  .cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left - 20px}; }
  .cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left - 20px}; }
}

.skill-layout-barbarian {
  /* Base skills - all races have these */
  .cs-pos-listening { --left: #{$cs-pos-listening-left + 20px}; }
  .cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left + 20px}; }
  .cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left + 20px}; }
  
  /* Barbarian-specific skills */
  .cs-pos-climb-sheer { --left: #{$cs-pos-climb-sheer-left + 20px}; }
  .cs-pos-move-silently { --left: #{$cs-pos-move-silently-left + 20px}; }
  .cs-pos-hide-undergrowth { --left: #{$cs-pos-hide-undergrowth-left + 20px}; }
  
  /* Skills that might be present from race */
  .cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left + 20px}; }
  .cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left + 20px}; }
}

.skill-layout-thief {
  /* Base skills - all races have these */
  .cs-pos-listening { --left: #{$cs-pos-listening-left - 40px}; }
  .cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left - 40px}; }
  .cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left - 40px}; }
  
  /* Thief-specific skills */
  .cs-pos-climb-sheer { --left: #{$cs-pos-climb-sheer-left - 40px}; }
  .cs-pos-hide-shadows { --left: #{$cs-pos-hide-shadows-left - 40px}; }
  .cs-pos-move-silently { --left: #{$cs-pos-move-silently-left - 40px}; }
  .cs-pos-find-traps { --left: #{$cs-pos-find-traps-left - 40px}; }
  .cs-pos-open-locks { --left: #{$cs-pos-open-locks-left - 40px}; }
  .cs-pos-pick-pockets { --left: #{$cs-pos-pick-pockets-left - 40px}; }
  
  /* Skills that might be present from race */
  .cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left - 40px}; }
  .cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left - 40px}; }
}

/* Race-based position adjustments (only if no qualifying class) */
/* OLD RACE-BASED SKILL LAYOUTS REMOVED - REPLACED BY RACIAL-SKILL-LAYOUT SYSTEM */

/* COMPLEX RACE+CLASS COMBINATIONS REMOVED - REPLACED BY SIMPLIFIED RACIAL-SKILL-LAYOUT SYSTEM */

/* Generic fallback layout (default positioning when no other conditions are met) */
.skill-layout-default {
  /* Uses default positioning - ensures consistent class-based approach */
  position: relative;
}

/* Background Image Override - Apply to entire sheet and window */
form.osp.sheet.actor.character,
.osp.sheet.actor.character,
.application.window-app.sheet.actor.character.osp,
.application.window-app.sheet.actor.character.osp .window-content,
.window-content form.osp.sheet.actor.character,
.window-content .osp.sheet.actor.character,
.window-content .window-content form.osp.sheet.actor.character,
.osp .window-content {
  /*background: url('/systems/osp-houserules/assets/backgrounds/parchment1.webp') no-repeat center center !important;
  background-size: 100% !important;
  background-attachment: scroll !important;*/
  background-color: #b5ddb0
}

/* Single Background Image System - Applied to window instead of form */
form.osp.sheet.actor.character {
  position: relative;
  color: #5703EF !important; /* Default text color for all sheet content */
  /*padding: 15px; /* Add 15px padding on all sides for spacing */
  box-sizing: border-box; /* Include padding in dimensions */
}

/* Global form element reset - remove redundant declarations */
form.osp.sheet.actor.character input,
form.osp.sheet.actor.character select,
form.osp.sheet.actor.character textarea,
form.osp.sheet.actor.character button {
  box-shadow: none !important;
  color: inherit !important;
  appearance: none !important;
  -webkit-appearance: none !important;
  -moz-appearance: none !important;
}

/* Ensure the application window allows tabs to extend beyond right edge */
.application.window-app.sheet.actor.character.osp {
  overflow: visible !important;
}

/* Prevent accidental stacking-contexts on ancestors which can break z-index ordering */
.application.window-app.sheet.actor.character.osp,
.application.window-app.sheet.actor.character.osp .window-content,
.osp.sheet.actor.character,
.window-content,
.window-content .window-content,
.osp .window-content,
form.osp.sheet.actor.character {
  transform: none !important;
  opacity: 1 !important;
  filter: none !important;
  will-change: auto !important;
  backface-visibility: visible !important;
}

/* Window content wrapper - inherits background from main declaration above */
.application.window-app.sheet.actor.character.osp .window-content,
.osp .window-content {
  /* Background already set by main rule above */
  padding: 0 !important;
  overflow: visible !important;
}

/* Black title bar for character sheet window */
.application.window-app.sheet.actor.character.osp .window-header,
.osp .window-header {
  background: black !important;
  background-color: black !important;
  border-bottom: 1px solid #333 !important;
}

.application.window-app.sheet.actor.character.osp .window-header .window-title,
.osp .window-header .window-title { color: white !important; }
.application.window-app.sheet.actor.character.osp .window-header .header-button,
.osp .window-header .header-button { color: white !important; }
.application.window-app.sheet.actor.character.osp .window-header .header-button:hover,
.osp .window-header .header-button:hover { background: rgba(255,255,255,0.2) !important; }

/* XP progress bar */
form.osp.sheet.actor.character .xp-progress-bar,
.osp.sheet.actor.character .xp-progress-bar { background-color: #ff0000 !important; }

/* Static header - consolidated background image and layout properties */
form.osp.sheet.actor.character .static-header,
.static-header,
.cs-static-header {
  /*position: relative;*/
  background-color: transparent !important;
  height: 286.5px !important;
  z-index: var(--z-sheet, 10);
  /*margin: 4px 3.6px 0px 4px !important;*/
}

/* Header frame image as pseudo-element with higher z-index */
form.osp.sheet.actor.character .static-header::before,
.static-header::before,
.cs-static-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url('/systems/osp-houserules/assets/character-sheet/basics.webp') no-repeat !important;
  background-position: left top !important;
  background-size: contain !important;
  z-index: 15 !important; /* Higher than portrait (z-index 5) to overlay it */
  pointer-events: none; /* Allow clicks to pass through */
}

/* Tab container styling */
form.osp.sheet.actor.character .sheet-tabs,
.osp.sheet.actor.character .sheet-tabs,
.sheet.actor.character .sheet-tabs {
  background: transparent !important;
  border: none !important;
  margin-bottom: 0 !important;
}

/* Parchment-themed tabs that blend seamlessly with sheet */
form.osp.sheet.actor.character .sheet-tabs a.item,
.osp.sheet.actor.character .sheet-tabs a.item,
.sheet.actor.character .sheet-tabs a.item { 
  opacity: 1 !important; 
  background: url('/systems/osp-houserules/assets/backgrounds/osp-parchment-background.webp') center center !important;
  background-size: cover !important;
  background-attachment: scroll !important;
  filter: none !important; /* Remove filters - use same color as sheet */
  border: 1px solid rgba(112, 66, 20, 0.4) !important; /* Borders on all 4 sides for inactive */
  position: relative !important;
  z-index: 10 !important;
}

form.osp.sheet.actor.character .sheet-tabs a.item:hover,
.osp.sheet.actor.character .sheet-tabs a.item:hover,
.sheet.actor.character .sheet-tabs a.item:hover { 
  opacity: 1 !important; 
  background: url('/systems/osp-houserules/assets/backgrounds/osp-parchment-background.webp') center center !important;
  background-size: cover !important;
  background-attachment: scroll !important;
  filter: brightness(1.05) !important; /* Slightly brighter on hover */
  border: 1px solid rgba(112, 66, 20, 0.6) !important; /* Slightly darker border on hover */
  z-index: 15 !important;
}

form.osp.sheet.actor.character .sheet-tabs a.item.active,
.osp.sheet.actor.character .sheet-tabs a.item.active,
.sheet.actor.character .sheet-tabs a.item.active { 
  opacity: 1 !important; 
  background: url('/systems/osp-houserules/assets/backgrounds/osp-parchment-background.webp') center center !important;
  background-size: cover !important;
  background-attachment: scroll !important;
  filter: none !important; /* No filter - exact same appearance as sheet */
  border: 1px solid rgba(112, 66, 20, 0.4) !important; /* Borders on top, right, left */
  border-bottom: none !important; /* No bottom border - connects to sheet */
  z-index: 20 !important;
  position: relative !important;
  margin-bottom: -1px !important; /* Overlap with sheet to hide sheet's top border */
}

/* Tab content area - seamlessly blends with active tab */
.sheet-body .tab { 
  display: none; 
  background: none !important; 
  border-top: 1px solid rgba(112, 66, 20, 0.4) !important; /* Top border that active tab will cover */
  border-left: none !important;
  border-right: none !important;
  border-bottom: none !important;
  margin-top: 0 !important;
}
.sheet-body .tab.active { 
  display: block; 
}

/* Height/Weight neutralization */
.char-height, .char-weight { background: transparent !important; border: none !important; border-radius: 0 !important; outline: none !important; }
.height-group, .weight-group { background: transparent !important; border: none !important; outline: none !important; }

/* XP Award Button */
button.xp-award-btn { background: none !important; border: none !important; outline: none !important; }
button.xp-award-btn:hover, button.xp-award-btn:focus { color: #8B4513 !important; }

/* Portrait transform now included in main portrait-img rule */

.portrait-controls { position: absolute; top: 100%; left: 0; margin-top: 5px; background: rgba(0,0,0,0.95); color: white; padding: 3px; border-radius: 3px; display: none; z-index: var(--z-overlay, 1000); font-size: 10px; white-space: nowrap; border: 1px solid #666; box-shadow: 0 2px 4px rgba(0,0,0,0.5); }
.portrait-controls[style*="display: block"] { display: block !important; visibility: visible !important; opacity: 1 !important; }
.portrait-controls button { background: #555; color: white; border: 1px solid #777; padding: 2px 4px; margin: 1px; border-radius: 2px; cursor: pointer; font-size: 10px; width: 18px; height: 18px; line-height: 14px; display: inline-block; text-align: center; box-sizing: border-box; }
.portrait-controls button:hover { background: #777; border-color: #999; }
.portrait-controls button:active { background: #333; }
.portrait-controls .btn-group { display: inline-block; margin: 0 2px; vertical-align: top; }
.portrait-controls .btn-group:not(:last-child) { border-right: 1px solid #777; padding-right: 3px; }
.portrait-container.adjusting { outline: 1px dashed #00aaff; overflow: visible !important; z-index: calc(var(--z-overlay, 1000) + 1) !important; }

/* Tooltip classes to replace JS-injected cssText */
.cs-tooltip { 
  position: absolute; 
  background: #333; 
  color: white; 
  padding: 8px 12px; 
  border-radius: 4px; 
  font-size: 12px; 
  line-height: 1.4; 
  z-index: var(--z-overlay, 1000); 
  pointer-events: none; 
  opacity: 0; 
  transition: opacity 0.2s; 
  white-space: nowrap;
  
  /* Auto-hide animation for stuck tooltips */
  animation: tooltip-auto-hide 3s ease-out forwards;
}

@keyframes tooltip-auto-hide {
  0% { opacity: var(--tooltip-opacity, 0); }
  20% { opacity: var(--tooltip-opacity, 0); }
  80% { opacity: var(--tooltip-opacity, 0); }
  100% { opacity: 0 !important; }
}

.cs-tooltip--xp { box-shadow: 0 2px 8px rgba(0,0,0,0.3); z-index: var(--z-top, 10000); }
.cs-tooltip--portrait { box-shadow: 0 2px 8px rgba(0,0,0,0.3); z-index: var(--z-top, 10000); }
.cs-tooltip--ability { 
  box-shadow: 0 2px 8px rgba(0,0,0,0.3); 
  z-index: var(--z-top, 10000); 
  pointer-events: none !important;
  
  /* Faster auto-hide for ability tooltips since they're more prone to sticking */
  animation: tooltip-auto-hide-fast 2s ease-out forwards;
}

@keyframes tooltip-auto-hide-fast {
  0% { opacity: var(--tooltip-opacity, 0); }
  10% { opacity: var(--tooltip-opacity, 0); }
  70% { opacity: var(--tooltip-opacity, 0); }
  100% { opacity: 0 !important; }
}

/* Dialog helper used by XP award dialog to centralize its presentation */
.cs-xp-dialog { background: white !important; }
.cs-xp-dialog .window-header { background: black !important; color: white !important; }
.cs-xp-dialog .window-content { background: white !important; }

/* Dialog layout and control helpers for handler-generated markup */
.cs-xp-dialog-container { padding: 10px; }
.cs-xp-row { margin-bottom: 20px; text-align: center; }
.cs-xp-inline { margin-bottom: 10px; display: flex; align-items: center; gap: 8px; justify-content: center; }
.cs-xp-flex { display: flex; gap: 20px; }
.cs-xp-col { flex: 1; }
.cs-input-small { width: 60px; padding: 5px; background-color: white; border: 1px solid black; border-radius: 9px; text-align: center; }
.cs-input-medium { width: 80px; padding: 5px; background-color: white; border: 1px solid black; border-radius: 9px; text-align: center; }
.cs-no-border { border: none; background: none; color: inherit; padding: 0; }
.cs-xp-preview { margin-top: 15px; padding: 8px; background: #f5f5f5; border-radius: 3px; display: none; }

/* XP dialog side column helpers (replaces small inline wrappers) */
.cs-xp-side { flex: 1; display: flex; flex-direction: column; justify-content: center; }
.cs-xp-side-row { margin-bottom: 10px; display: flex; align-items: center; gap: 8px; justify-content: center; }

/* Reusable small select style for inline dialogs (appearance reset handled elsewhere) */
.cs-select-inline { width: 60px; padding: 5px; background-color: white; border: 1px solid black; border-radius: 9px; text-align: center; line-height: 1.2; appearance: none; -webkit-appearance: none; -moz-appearance: none; }

/* Language dialog helpers */
.cs-dialog-row { margin-bottom: 8px; }
.cs-dialog-columns { display: flex; gap: 40px; }
.cs-dialog-column { display: flex; flex-direction: column; align-items: flex-start; gap: 6px; }
.cs-custom-input { width: 145px; }
.cs-dialog-label { display: flex; align-items: center; gap: 8px; }

/* Level & portrait container utility classes (migrate inline box-shadow/positioning into class-based rules) */
.cs-level-container { position: absolute; width: 64px; height: 34px; }
.cs-level-shadow { position: absolute; top: 0; left: 0; width: 64px; height: 34px; z-index: var(--z-labels, 15); pointer-events: none; border-radius: 6px; }

/* Combat and ability layouts markup helpers */
.cs-combat-stats { display: flex; gap: 1.5rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }
.cs-combat-stat { display: flex; flex-direction: column; align-items: center; }
.cs-save-badge { border: none !important; border-radius: 0 !important; background-color: transparent !important; position: relative; width: auto !important; height: auto !important; }

/* Ability score box */
.cs-ability-select {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-variant-numeric: tabular-nums;
  
  /* Remove explicit dimensions - let container (.cs-ability) handle sizing */
  width: 100%;
  height: 100%;
  font-size: 80px;
  font-weight: normal;
  border: none !important;
  background: transparent !important;
  position: relative; /* Ensure proper positioning context */
  z-index: var(--z-labels, 15); /* Ensure tooltips work properly */
  pointer-events: auto; /* Ensure mouse events work */
  line-height: 1;
  transform: translateY(-0.1em); /* Vertical centering adjustment for select elements */
}

/* NOTE: Old .cs-ability positioning removed - now uses simplified system at bottom of file */

/* Hide tooltips when dropdown is active/focused */
.cs-ability-select:focus ~ .cs-tooltip,
.cs-ability-select:active ~ .cs-tooltip,
.cs-ability-select:focus-within ~ .cs-tooltip {
  opacity: 0 !important;
  visibility: hidden !important;
  animation: none !important;
}

/* Hide tooltips when any dropdown in the ability section is open */
.ability-scores-section:focus-within .cs-tooltip {
  opacity: 0 !important;
  visibility: hidden !important;
  animation: none !important;
}

/* ================================================================
   SIMPLIFIED POSITIONING SYSTEM
   ================================================================
   Group-based positioning with individual field overrides.
   Positioning tool uses --left, --top, --width, --height for overrides.
   
   Variable Priority (CSS Cascade):
   1. --left, --top, --width, --height (positioning tool - highest priority)
   2. --field-left, --group-top, --field-width, --field-height (field defaults)
   3. Hardcoded fallback values (lowest priority)
   ================================================================ */

/* Group Defaults - Shared coordinates for field groups */
:root {
  --ability-group-top: 53px;
  --save-group-top: 178px;
  --ability-group-width: 87px;
  --ability-group-height: 65px;
  --save-group-width: 87px;
  --save-group-height: 65px;
}

/* Ability Group Positioning - Individual X coordinates */
.ability:has(.attr-str) { --field-left: 1px; }
.ability:has(.attr-int) { --field-left: 101px; }
.ability:has(.attr-wis) { --field-left: 202px; }
.ability:has(.attr-dex) { --field-left: 303px; }
.ability:has(.attr-con) { --field-left: 404px; }
.ability:has(.attr-cha) { --field-left: 504px; }

/* Listening at Doors field styling */
.listening-group {
  z-index: var(--z-labels, 15);
  pointer-events: auto;
}

/* Hide Barbarian skill fields by default - JavaScript will show them when needed */
.cs-pos-barbarian-climb,
.cs-pos-barbarian-hide,
.cs-pos-barbarian-move {
  display: none;
}

.listening-group .cs-field-label {
  display: none !important;
}

.cs-listening-select {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  
  width: 58px;
  height: 58px;
  font-size: 60px;
  background-color: transparent !important;

  margin: 0;
  border: none !important;
  pointer-events: auto;
}

.cs-listening-select:disabled {
  cursor: not-allowed;
}

/* Tabs helper (in case nav items had inline styles) */
.cs-tabs { display: flex; flex-direction: column; }
.cs-tab-item { 
  opacity: 1 !important; 
  background: rgba(139, 123, 101, 0.4) !important; /* Semi-transparent to show parchment */
  
}

/* Tabs runtime helpers */
.cs-tabs {
  position: relative !important;
  z-index: var(--z-top, 10000) !important;
  pointer-events: auto !important;
  top: var(--tabs-top, 3px);
}
.cs-tab-item {
  position: relative !important;
  z-index: 10 !important; /* Base tab layer */
  pointer-events: auto !important;
  cursor: pointer !important;
}

/* Active tab state for cs-tab-item */
.cs-tab-item.active {
  z-index: 20 !important; /* Active tab comes forward */
  border-left: none !important; /* Seamless connection to page */
  background: rgba(255, 255, 255, 0.8) !important; /* More opaque for active tab */
}

/* Hover state for cs-tab-item */
.cs-tab-item:hover {
  z-index: 15 !important; /* Hover tab comes slightly forward */
  background: rgba(139, 123, 101, 0.6) !important; /* Slightly more opaque on hover */
}
.cs-force-pointer { pointer-events: auto !important; }

/* Cursor helper classes for JS toggles */
.cs-cursor-pointer { cursor: pointer !important; }
.cs-cursor-text { cursor: text !important; }

/* XP progress width via CSS variable */
.xp-progress { --xp-progress-width: 0%; }
.xp-progress { --xp-progress-color: rgba(255, 0, 0, 1); }
.xp-progress .xp-progress-fill { width: var(--xp-progress-width); transition: width 0.3s ease; background-color: var(--xp-progress-color, rgba(112, 66, 21, 0.8)); }

/* Combat stat boxes */
.cs-combat-stats { display: flex; gap: 1.5rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }
.cs-combat-stat { display: flex; flex-direction: column; align-items: center; }
.cs-combat-input {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-variant-numeric: tabular-nums;
  
  width: 80px;
  height: 40px;
  /*font-size: 1.2rem;*/
  border: 2px solid #4a5568;
  border-radius: 8px;
  background-color: white;
}

/* Combat tab background - Base layers for all layouts */
.tab[data-tab="combat"] {
  position: relative;
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-default.webp') !important;
  background-size: contain, contain !important;
  background-position: center top, left 282.75px !important;
  background-repeat: no-repeat, no-repeat !important;
  background-attachment: scroll, scroll !important;
  background-color: transparent !important;
  height: 367px !important;
}

/* Add skill targets bar as a shared layer for all combat tabs */
.tab[data-tab="combat"]::before {
  content: "";
  position: absolute;
  top: 242px;
  left: 0px;
  width: 100%;
  height: 100%;
  background-image: url('/systems/osp-houserules/assets/character-sheet/racial-skill-targets-bar.webp');
  background-size: contain;
  background-position: left top;
  background-repeat: no-repeat;
  pointer-events: none;
  z-index: 1;
}

/* Combat Tab Styles */
.tab[data-tab="combat-tab"] {
  position: relative;
  background-color: transparent;
  padding: 20px;
  height: 400px;
  
  .combat-content {
    padding: 20px;
    text-align: center;
    font-size: 16px;
    color: #2c1810;
  }
  
  /* Combat Stats in Combat Tab */
  .combat-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    margin-top: 20px;
    
    .combat-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 120px;
      
      .cs-field-label {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 5px;
        color: #2c1810;
        text-align: center;
      }
      
      .cs-combat-input {
        width: 80px;
        height: 40px;
        text-align: center;
        font-size: 16px;
        border: 2px solid #8b4513;
        border-radius: 4px;
        background-color: rgba(240, 228, 188, 0.8);
        color: #2c1810;
        
        &:focus {
          outline: none;
          border-color: #654321;
          background-color: rgba(240, 228, 188, 1);
        }
      }
      
      .cs-unarmored-box {
        width: 80px;
        height: 40px;
        text-align: center;
        font-size: 16px;
        border: 2px solid #8b4513;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(240, 228, 188, 0.6);
        color: #2c1810;
        font-weight: bold;
      }
    }
  }
}

/* Skill target variants - Only override the skill targets image */
/* Class-based variants */
.skill-layout-assassin .tab[data-tab="combat"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-assassin.webp') !important;
  min-height: 380px !important;
  max-height: 400px !important;
}

.skill-layout-barbarian .tab[data-tab="combat"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/racial-skill-targets-barbarian.webp') !important;
  min-height: 450px !important;
  max-height: 470px !important;
}

.skill-layout-thief .tab[data-tab="combat"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-thief.webp') !important;
  min-height: 390px !important;
  max-height: 410px !important;
}

/* Race-based variants (only applied if no qualifying class) */
/* OLD RACE-BASED SKILL LAYOUT BACKGROUND IMAGES REMOVED - REPLACED BY RACIAL-SKILL-LAYOUT SYSTEM */

.cs-unarmored-box { width: 80px; height: 40px; text-align: center; font-size: 1.2rem; border: 2px solid #4a5568; border-radius: 8px; display: flex; align-items: center; justify-content: center; background-color: white; }

/* OLD RACIAL-SKILL-TARGETS SYSTEM REMOVED - REPLACED BY RACIAL-SKILL-LAYOUT SYSTEM */

/* ========================================
   RACIAL SKILL LAYOUT SYSTEM 
   Clean separation for 3 scenarios: Default, Dwarf, Gnome
   ======================================== */

/* Default racial skills (no race-specific skills, just base skills) */
.racial-skill-layout-default {
  /* Base skills positioning - uses default variables */
  .cs-pos-listening { 
    --left: #{$cs-pos-listening-left}; 
    --top: 300px; 
    --width: #{$cs-pos-listening-width}; 
    --height: #{$cs-pos-listening-height}; 
  }
  .cs-pos-find-secret-door { 
    --left: #{$cs-pos-find-secret-door-left}; 
    --top: 300px; 
    --width: #{$cs-pos-find-secret-door-width}; 
    --height: #{$cs-pos-find-secret-door-height}; 
  }
  .cs-pos-open-stuck-doors { 
    --left: #{$cs-pos-open-stuck-doors-left}; 
    --top: 300px; 
    --width: #{$cs-pos-open-stuck-doors-width}; 
    --height: #{$cs-pos-open-stuck-doors-height}; 
  }
  
  /* Background image for default racial skills */
  .tab[data-tab="combat"] {
    background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/racial-skill-targets-default.webp') !important;
    background-size: contain, contain !important;
    background-position: top center, left 282.75px !important;
    background-repeat: no-repeat, no-repeat !important;
    background-attachment: scroll, scroll !important;
  }
}

/* Dwarf racial skills (includes detect construction and detect room traps) */
.racial-skill-layout-dwarf {
  /* Base skills with dwarf-specific positioning */
  .cs-pos-listening { 
    --left: 268px; 
    --top: 300px; 
    --width: #{$cs-pos-listening-width}; 
    --height: #{$cs-pos-listening-height}; 
  }
  .cs-pos-find-secret-door { 
    --left: 143px; 
    --top: 300px; 
    --width: #{$cs-pos-find-secret-door-width}; 
    --height: #{$cs-pos-find-secret-door-height}; 
  }
  .cs-pos-open-stuck-doors { 
    --left: 19px; 
    --top: 300px; 
    --width: #{$cs-pos-open-stuck-doors-width}; 
    --height: #{$cs-pos-open-stuck-doors-height}; 
  }
  
  /* Dwarf-specific racial skills */
  .cs-pos-detect-construction { 
    --left: 392px; 
    --top: 300px; 
    --width: #{$cs-pos-detect-construction-width}; 
    --height: #{$cs-pos-detect-construction-height}; 
  }
  .cs-pos-detect-room-traps { 
    --left: 516px; 
    --top: 300px; 
    --width: #{$cs-pos-detect-room-traps-width}; 
    --height: #{$cs-pos-detect-room-traps-height}; 
  }
  
  /* Background image for dwarf racial skills */
  .tab[data-tab="combat"] {
    background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/racial-skill-targets-dwarf.webp') !important;
    background-size: contain, contain !important;
    background-position: top center, left 282.75px !important;
    background-repeat: no-repeat, no-repeat !important;
    background-attachment: scroll, scroll !important;
  }
}

/* Gnome racial skills (includes detect construction only) */
.racial-skill-layout-gnome {
  /* Base skills with gnome-specific positioning */
  .cs-pos-listening { 
    --left: 342px; 
    --top: 300px; 
    --width: #{$cs-pos-listening-width}; 
    --height: #{$cs-pos-listening-height}; 
  }
  .cs-pos-find-secret-door { 
    --left: 193px; 
    --top: 300px; 
    --width: #{$cs-pos-find-secret-door-width}; 
    --height: #{$cs-pos-find-secret-door-height}; 
  }
  .cs-pos-open-stuck-doors { 
    --left: 45px; 
    --top: 300px; 
    --width: #{$cs-pos-open-stuck-doors-width}; 
    --height: #{$cs-pos-open-stuck-doors-height}; 
  }
  
  /* Gnome-specific racial skills */
  .cs-pos-detect-construction { 
    --left: 491px; 
    --top: 300px; 
    --width: #{$cs-pos-detect-construction-width}; 
    --height: #{$cs-pos-detect-construction-height}; 
  }
  
  /* Background image for gnome racial skills */
  .tab[data-tab="combat"] {
    background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/racial-skill-targets-gnome.webp') !important;
    background-size: contain, contain !important;
    background-position: top center, left 282.75px !important;
    background-repeat: no-repeat, no-repeat !important;
    background-attachment: scroll, scroll !important;
  }
}

/* Save badge system */
.combat-section {
  position: relative;
  width: 100%;
  /*height: 400px; /* Set a height to contain the absolutely positioned saves */
}

/* Simplified positioning - cs-save-group no longer needs absolute positioning 
   since individual saves handle their own positioning */
.cs-save-group { 
  display: inline-block; 
  margin: 0;
}

/* Universal absolute positioning for all positioned elements */
.cs-abs {
  position: absolute !important;
  /* Use consistent variable cascade that matches specific positioning systems */
  left: var(--left, var(--field-left, auto)) !important;
  top: var(--top, var(--group-top, auto)) !important;
  width: var(--width, var(--field-width, auto)) !important;
  height: var(--height, var(--field-height, auto)) !important;
  z-index: var(--z, 2) !important;
}

/* Simplified: No override rules needed - positioning tool variables integrated directly */

/* Save Group Positioning - Individual X coordinates */
.save-group-death { --field-left: 1px; }
.save-group-wands { --field-left: 127px; }
.save-group-paralysis { --field-left: 253px; }
.save-group-breath { --field-left: 378px; }
.save-group-spells { --field-left: 504px; }
.cs-save-value {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  
  font-size: 80px !important;
}

/* Misc helpers for textareas in bio */
.cs-bio-textarea { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 3px; resize: vertical; font-family: inherit; background-color: white; }

/* Encumbrance bar helpers */
.encumbrance-section .encumbrance-bar-container { position: relative; }
.encumbrance-section .encumbrance-bar { height: 12px; background: #22c55e; transition: width 0.3s ease; }
.encumbrance-section .encumbrance-bar { width: var(--encumbrance-width, 0%); }

/* Level progress helpers */
.cs-level-progress-bar { 
    position: absolute; 
    top: 0; 
    left: 0; 
    height: 100%; 
    border-radius: 3px; 
    background-color: rgba(255, 0, 0, 1); 
    width: 0%; 
    transition: width 0.3s ease; 
}

.cs-level-display {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  width: 61px;
  height: 29px;
  font-size: 34px;
  z-index: var(--z-level, -10);
  background: transparent !important;
  padding: 0 0 2px 0;
}

/* Portrait helpers - configurable dimensions via CSS variables */
.cs-portrait-container { 
  position: absolute; 
  width: var(--width, 215px) !important; /* Use CSS variable with fallback */
  height: var(--height, 249px) !important; /* Use CSS variable with fallback */
  overflow: hidden; 
  z-index: 25 !important; /* Force portrait above header frame */
  --z: 25; /* Set CSS variable for .cs-abs compatibility */
}
.cs-portrait-display,
.portrait-display { 
  position: absolute; 
  top: 0; 
  left: 0; 
  width: 100%; 
  height: 100%; 
  cursor: pointer; 
  border-radius: 3px; 
  overflow: hidden; 
  pointer-events: auto; 
  z-index: 20 !important; /* Force above header frame */
}
.cs-portrait-img,
.portrait-img { 
  /* Default size: fit within container while maintaining aspect ratio */
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  display: block; 
  /* Player can resize and reposition from this starting size */
  transform: scale(var(--user-portrait-scale, 1)) translate(var(--user-portrait-x, 0px), var(--user-portrait-y, 0px));
  transform-origin: center center;
  transition: transform 0.2s ease;
}

/* XP/Next level small field helpers */
.cs-field {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  
  background-color: transparent !important;
  border: none;

  margin: 0;
  color: inherit;
  padding: 0 2px 0 2px;
}
.cs-xp-mod-display {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-variant-numeric: tabular-nums;
  
  width: 74px;
  height: 39px;
  pointer-events: none;
  font-size: 36px;
}

.cs-xp-display {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-variant-numeric: tabular-nums;
  
  width: 160px;
  height: 40px;
  cursor: pointer;
  pointer-events: auto;
  font-size: 36px;
}

/* ================================================================
   SIMPLIFIED VISUAL CENTERING
   ================================================================ */

/* Modern CSS centering - no complex placeholders needed */

/* Basic input styling - simplified centering */
input[type="text"], 
input[type="number"], 
select {
  text-align: center;
  
  /* Remove number input spinners for cleaner appearance */
  &::-webkit-outer-spin-button,
  &::-webkit-inner-spin-button {
    -webkit-appearance: none;
    appearance: none;
    margin: 0;
  }
}

input[type="number"] {
  -moz-appearance: textfield;
  appearance: textfield;
}



/* Header field classes (name, class, race, small fields) */
/*.cs-char-field-group { display: flex; flex-direction: column; align-items: center; margin-bottom: -5px; }*/
.cs-char-name {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  
  width: 332px;
  height: 39px;
  font-size: 36px;
  background-color: transparent !important;
  white-space: nowrap;
  text-overflow: clip;
  border: none;
  padding: 0 2px 0 2px;
}

.cs-class-select {
  /* Removed conflicting @extend mixins - using manual centering instead */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  
  width: 160px;
  height: 39px;
  font-size: 36px;
  background-color: transparent !important;

  margin: 0;
  border: none;
  pointer-events: auto;
  padding: 0 2px 0 2px;
}

/* Background field - separate class for independent control */
.cs-background-select {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  line-height: 1;
  box-sizing: border-box;
  width: 160px;
  height: 39px;
  font-size: var(--background-font-size, 36px);
  font-weight: normal;
  letter-spacing: 0;
  background-color: transparent !important;
  border: none;
  margin: 0;
  padding: 0 5px 0 5px;
  pointer-events: auto;
  cursor: pointer;
  vertical-align: middle;
  white-space: nowrap;
  text-overflow: clip;
  overflow: visible;
  &:focus {
    outline: none;
  }
  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
}

/* Race field - separate class for independent control */
.cs-race-select {
  /* Inherit base layout from large selects but allow independent styling */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  
  /* Size and positioning */
  width: 159px;
  height: 39px;
  
  /* Typography - customize as needed */
  font-size: 36px;
  font-weight: normal;
  letter-spacing: 0;
  
  /* Appearance */
  background-color: transparent !important;
  color: inherit;
  border: none;

  /* Layout */
  margin: 0;
  padding: 0 5px 2px 5px;
  
  /* Interaction */
  pointer-events: auto;
  cursor: pointer;
  
  /* Focus states - customize as needed */
  &:focus {
    outline: none;
  }
  
  /* Disabled states (for race-as-class synchronization) */
  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    background-color: rgba(0, 0, 0, 0.05) !important;
  }
}

/* XP container with XP progress bar */
.xp-group {
  position: relative;
  width: 131px;
  height: 30px;
  
  /* XP Progress bar within XP field */
  .level-xp-progress {
    position: absolute;
    top: 0px;
    left: 0px;
    height: 40px;
    width: var(--level-height, 0%);
    background: var(--level-bg, linear-gradient(to right, rgba(255, 0, 0, 0.2) 0%, rgba(255, 0, 0, 1) 100%));
    transition: width 0.3s ease;
    z-index: 1;
    border-radius: 3px;
    overflow: hidden;
  }
  
  /* XP display sits on top of progress bar */
  .cs-xp-display {
    position: relative;
    z-index: 2;
  }
}

/* Alignment field - separate class for independent control */
.cs-alignment-select {
  display: flex;
  text-align: center;
  box-sizing: border-box;
  width: 159px;
  height: 39px;
  font-size: 36px;
  background-color: transparent !important;
  color: inherit;
  border: none;
  padding: 0 5px 0 5px;
  pointer-events: auto;
  cursor: pointer;

  &:focus {
    outline: none;
  }
}

/* Height field - separate class for independent control */
.cs-height-field {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  width: 74px;
  height: 39px;
  font-size: 36px;
  letter-spacing: 0;
  background-color: transparent !important;
  color: inherit;
  border: none;
  margin: 0;
  padding: 0 2px 0 2px;
  pointer-events: auto;
  cursor: text;
  vertical-align: middle;
  &:focus {
    outline: none;
  }
  &::placeholder {
    color: #704214;
    font-style: italic;
  }
}

/* Weight field - separate class for independent control */
.cs-weight-field {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  line-height: 1;
  box-sizing: border-box;
  width: 73px;
  height: 39px;
  font-size: 36px;
  letter-spacing: 0;
  background-color: transparent !important;
  color: inherit;
  border: none;
  margin: 0;
  padding: 0;
  pointer-events: auto;
  cursor: text;
  vertical-align: middle;
  &:focus {
    outline: none;
  }
  &::placeholder {
    color: #704214;
    font-style: italic;
  }
}

/* Languages field - separate class for independent control */
.cs-languages-field {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  width: 331px;
  height: 39px;
  font-size: var(--languages-font-size, 36px);
  font-weight: normal;
  letter-spacing: var(--languages-letter-spacing, 0px);
  line-height: var(--languages-line-height, 1);
  background: transparent !important;
  border: none !important;
  margin: 0;
  padding: 2px 3px 2px 3px;
  pointer-events: auto;
  cursor: pointer;
  user-select: none;
  vertical-align: middle;
}

/* Age field - separate class for independent control */
.cs-age-field {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  width: 74px;
  height: 40px;
  font-size: 36px;
  background-color: transparent !important;
  border: none;
  vertical-align: middle;
}

/* Sex field - separate class for independent control */
.cs-sex-field {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  width: 73px;
  height: 39px;
  font-size: 36px;
  background-color: transparent !important;
  border: none;
  cursor: pointer;
  vertical-align: middle;
  option {
    font-size: 16px;
    color: #704214;
    background-color: #ffffff;
  }
}

/* Keep this partial focused on presentation only; behavior remains in JS. */

/* Note: .cs-abs positioning now handled by the unified system above */



/* Sheet body helper to centralize padding/scrolling */
.cs-sheet-body {
  position: absolute !important;
  top: var(--sheet-top, 241.75px);
  left: 0;
  right: 0;
  bottom: 0;
  padding: 0 19px 0px 19px;
  /* overflow-y: auto; */
}

/* Generic small field label */
.cs-field-label { margin-bottom: 0.5rem; font-size: 1.1rem; }

/* Languages row and tags reset for consistent layout */
.languages-row.open-language-dialog { width: var(--languages-row-width, 272px); height: 33px; min-height: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 2px; z-index: var(--z-lang-row, 101); }
.languages-tags { 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  width: 100%; 
  line-height: 0.6;
  white-space: wrap; /* Allow wrapping when needed */
  overflow: hidden; 
  font-size: var(--languages-font-size, 34px) !important;
  padding: 0 4px;


  text-align: center;
  word-wrap: break-word; /* Allow breaking long words if needed */
  
  /* When not empty, ensure our font size applies - higher specificity */
  &:not(:empty) {
    font-size: var(--languages-font-size, 34px) !important;
  }
}

/* Bio content wrapper */
.bio-content { padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }

/* Position presets (centralize numeric offsets) */
.cs-pos-level { --left: #{$cs-pos-level-left}; --top: #{$cs-pos-level-top}; --z: var(--z-level, 8); }
.cs-pos-portrait { --left: #{$cs-pos-portrait-left}; --top: #{$cs-pos-portrait-top}; --z: 5; }
.cs-pos-languages { --left: #{$cs-pos-languages-left}; --top: #{$cs-pos-languages-top}; --z: var(--z-labels, 15); --pointer: auto; }
.cs-pos-xpmod { --left: #{$cs-pos-xpmod-left}; --top: #{$cs-pos-xpmod-top}; --z: var(--z-labels, 15); }
.cs-pos-xp { --left: #{$cs-pos-xp-left}; --top: #{$cs-pos-xp-top}; --z: var(--z-portrait, 15); }
.cs-pos-next { --left: #{$cs-pos-next-left}; --top: #{$cs-pos-next-top}; --z: var(--z-labels, 15); }
.cs-pos-sep { --bottom: 0; --left: 0; --right: 0; --height: 1px; --bg: transparent; --z: var(--z-labels, 15); }

/* Header / small-field presets discovered during the sweep */
.cs-pos-namegroup { --left: #{$cs-pos-namegroup-left}; --top: #{$cs-pos-namegroup-top}; --z: var(--z-labels, 15); }
.cs-pos-class { --left: #{$cs-pos-class-left}; --top: #{$cs-pos-class-top}; --z: var(--z-labels, 15); }
.cs-pos-alignment { --left: #{$cs-pos-alignment-left}; --top: #{$cs-pos-alignment-top}; --z: var(--z-labels, 15); }
.cs-pos-race { --left: #{$cs-pos-race-left}; --top: #{$cs-pos-race-top}; --z: var(--z-labels, 15); }
.cs-pos-age { --left: #{$cs-pos-age-left}; --top: #{$cs-pos-age-top}; --z: var(--z-labels, 15); }
.cs-pos-sex { --left: #{$cs-pos-sex-left}; --top: #{$cs-pos-sex-top}; --z: var(--z-labels, 15); }
.cs-pos-height { --left: #{$cs-pos-height-left}; --top: #{$cs-pos-height-top}; --z: var(--z-labels, 15); }
.cs-pos-weight { --left: #{$cs-pos-weight-left}; --top: #{$cs-pos-weight-top}; --z: var(--z-labels, 15); }
.cs-pos-background { --left: #{$cs-pos-background-left}; --top: #{$cs-pos-background-top}; --z: var(--z-labels, 15); }
.cs-pos-listening { --left: #{$cs-pos-listening-left}; --top: #{$cs-pos-listening-top}; --width: #{$cs-pos-listening-width}; --height: #{$cs-pos-listening-height}; --z: var(--z-labels, 15); }

/* Universal Save Positioning - Simplified System with Tool Integration */
.cs-save {
  position: absolute !important;
  /* Positioning tool variables take precedence, then field defaults, then group defaults */
  left: var(--left, var(--field-left, 0px)) !important;
  top: var(--top, var(--group-top, var(--save-group-top))) !important;
  width: var(--width, var(--field-width, var(--save-group-width))) !important;
  height: var(--height, var(--field-height, var(--save-group-height))) !important;
  z-index: var(--z-labels, 15) !important;
}

/* Universal Ability Positioning - Simplified System with Tool Integration */
.cs-ability {

  /* Positioning tool variables take precedence, then field defaults, then group defaults */
  left: var(--left, var(--field-left, 504px)) !important;
  top: var(--top, var(--group-top, var(--ability-group-top))) !important;
  width: var(--width, var(--field-width, var(--ability-group-width))) !important;
  height: var(--height, var(--field-height, var(--ability-group-height))) !important;
  z-index: var(--z-labels, 15) !important;
  pointer-events: auto !important;
}

/* Small helpers found useful during migration */
.cs-tab-relative { position: relative; }
.cs-bio-heading { margin: 0 0 0.5rem 0; padding-bottom: 0.25rem; border-bottom: 1px solid #ccc; font-size: 1.1em; }

/* ============================
   SKILLS TAB BACKGROUND SYSTEM
   ============================ */

/* Skills tab background - Default layout (no special background) */
.tab[data-tab="skills"] {
  position: relative;
  background-color: transparent !important;
  height: 367px !important;
}

/* Skills tab with class skill bar - For most classes */
.skills-layout-barbarian .tab[data-tab="skills"],
.skills-layout-gnome .tab[data-tab="skills"],
.skills-layout-half-orc .tab[data-tab="skills"],
.skills-layout-hobbit .tab[data-tab="skills"],
.skills-layout-thief .tab[data-tab="skills"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/class-skill-targets-bar.webp') !important;
  background-size: contain !important;
  background-position: center top !important;
  background-repeat: no-repeat !important;
  background-attachment: scroll !important;
  background-color: transparent !important;
}

/* Skills tab for Assassin - includes both class bar and assassin-specific targets */
.skills-layout-assassin .tab[data-tab="skills"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/class-skill-targets-bar.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-assassin.webp') !important;
  background-size: contain, contain !important;
  background-position: center top, center calc(22px + 0%) !important;
  background-repeat: no-repeat, no-repeat !important;
  background-attachment: scroll, scroll !important;
  background-color: transparent !important;
}

/* ============================
   CLASS SKILL POSITIONING FOR SKILLS TAB
   ============================ */

/* Move all class skill target fields to Skills tab when active */
.tab[data-tab="skills"] {
  /* Class-specific skill positioning - moved from Combat tab to Skills tab */
  .cs-pos-assassination { --left: 50px; --top: 50px; }
  .cs-pos-climb-sheer { --left: 150px; --top: 50px; }
  .cs-pos-hide-shadows { --left: 250px; --top: 50px; }
  .cs-pos-move-silently { --left: 350px; --top: 50px; }
  .cs-pos-find-traps { --left: 450px; --top: 50px; }
  .cs-pos-open-locks { --left: 100px; --top: 150px; }
  .cs-pos-pick-pockets { --left: 200px; --top: 150px; }
  .cs-pos-hide-undergrowth { --left: 300px; --top: 150px; }
}

/* Class skill fields are now physically located in the Skills tab */
