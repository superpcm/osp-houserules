<form class="osp sheet actor character" autocomplete="off">
  <div class="sheet-background">
    <!-- Tabs -->
    <nav class="sheet-tabs tabs" data-group="primary">
      <a class="item" data-tab="main">Main</a>
      <a class="item" data-tab="combat">Combat</a>
      <a class="item" data-tab="skills">Skills</a>
      <a class="item" data-tab="equipment">Equipment</a>
    </nav>
    <!-- Tab Contents -->
    <div class="sheet-body">
      <section class="tab" data-group="primary" data-tab="main">
        <div class="sheet-header" style="display: flex; align-items: flex-start; gap: 1rem; flex-wrap: wrap;">
          <div class="character-image" style="flex-shrink: 0;">
            <img src="{{actor.img}}" alt="{{actor.name}}" title="{{actor.name}}" data-edit="img" style="cursor:pointer; width: 96px; height: 96px; object-fit: cover; border: none;" />
          </div>
          <div class="character-info" style="display: flex; flex-direction: column; gap: 0.5rem; flex-grow: 1; min-width: 200px;">
            <div class="char-field-group" style="margin-bottom: 0.5rem;">
              <label for="char-name" style="margin-bottom: 2px; text-align: left;">Character Name</label>
              <input class="char-name" id="char-name" name="name" type="text" value="{{actor.name}}" placeholder="Character Name" style="font-size: 1.25rem; font-weight: bold; width: 100%;"/>
            </div>
            <div class="char-details" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
              <div class="char-field-group" style="display: flex; flex-direction: column; align-items: center;">
                <label for="char-race" style="margin-bottom: 2px; text-align: center;">Race</label>
                <select class="char-race" id="char-race" name="system.race" style="width: 80px; height: 2em; text-align: center;">
                  <option value="Dwarf" {{#if (eq system.race "Dwarf")}}selected{{/if}}>Dwarf</option>
                  <option value="Elf" {{#if (eq system.race "Elf")}}selected{{/if}}>Elf</option>
                  <option value="Gnome" {{#if (eq system.race "Gnome")}}selected{{/if}}>Gnome</option>
                  <option value="Half-Elf" {{#if (eq system.race "Half-Elf")}}selected{{/if}}>Half-Elf</option>
                  <option value="Half-Orc" {{#if (eq system.race "Half-Orc")}}selected{{/if}}>Half-Orc</option>
                  <option value="Hobbit" {{#if (eq system.race "Hobbit")}}selected{{/if}}>Hobbit</option>
                  <option value="Human" {{#if (eq system.race "Human")}}selected{{/if}}>Human</option>
                </select>
              </div>
              <div class="char-field-group" style="display: flex; flex-direction: column; align-items: center;">
                <label for="char-sex" style="margin-bottom: 2px; text-align: center;">Sex</label>
                <select class="char-sex" id="char-sex" name="system.sex" style="width: 70px; height: 2em; text-align: center;">
                  <option value="Male" {{#if (eq system.sex "Male")}}selected{{/if}}>Male</option>
                  <option value="Female" {{#if (eq system.sex "Female")}}selected{{/if}}>Female</option>
                  <option value="Other" {{#if (eq system.sex "Other")}}selected{{/if}}>Other</option>
                </select>
              </div>
              <div class="char-field-group" style="display: flex; flex-direction: column; align-items: center;">
                <label for="char-age" style="margin-bottom: 2px; text-align: center;">Age</label>
                <input class="char-age" id="char-age" name="system.age" type="text" value="{{system.age}}" style="width: 60px; height: 2em; text-align: center;" />
              </div>
              <div class="char-field-group" style="display: flex; flex-direction: column; align-items: center;">
                <label for="char-height" style="margin-bottom: 2px; text-align: center;">Height</label>
                <input class="char-height" id="char-height" name="system.height" type="text" value="{{system.height}}" style="width: 70px; height: 2em; text-align: center;" />
              </div>
              <div class="char-field-group" style="display: flex; flex-direction: column; align-items: center;">
                <label for="char-weight" style="margin-bottom: 2px; text-align: center;">Weight</label>
                <input class="char-weight" id="char-weight" name="system.weight" type="text" value="{{system.weight}}" style="width: 70px; height: 2em; text-align: center;" />
              </div>
            </div>
            <div class="char-details" style="display: flex; gap: 1rem; flex-wrap: wrap;">
              <div class="char-field-group" style="display: flex; flex-direction: column; align-items: center;">
                <label for="char-class" style="margin-bottom: 2px; text-align: center;">Class</label>
                <select class="char-class" id="char-class" name="system.class" style="width: 120px; height: 2em; text-align: center;">
                  <option value="Assassin" {{#if (eq system.class "Assassin")}}selected{{/if}}>Assassin</option>
                  <option value="Barbarian" {{#if (eq system.class "Barbarian")}}selected{{/if}}>Barbarian</option>
                  <option value="Bard" {{#if (eq system.class "Bard")}}selected{{/if}}>Bard</option>
                  <option value="Beast Master" {{#if (eq system.class "Beast Master")}}selected{{/if}}>Beast Master</option>
                  <option value="Cleric" {{#if (eq system.class "Cleric")}}selected{{/if}}>Cleric</option>
                  <option value="Druid" {{#if (eq system.class "Druid")}}selected{{/if}}>Druid</option>
                  <option value="Dwarf" {{#if (eq system.class "Dwarf")}}selected{{/if}}>Dwarf</option>
                  <option value="Elf" {{#if (eq system.class "Elf")}}selected{{/if}}>Elf</option>
                  <option value="Fighter" {{#if (eq system.class "Fighter")}}selected{{/if}}>Fighter</option>
                  <option value="Gnome" {{#if (eq system.class "Gnome")}}selected{{/if}}>Gnome</option>
                  <option value="Half-Elf" {{#if (eq system.class "Half-Elf")}}selected{{/if}}>Half-Elf</option>
                  <option value="Half-Orc" {{#if (eq system.class "Half-Orc")}}selected{{/if}}>Half-Orc</option>
                  <option value="Hobbit" {{#if (eq system.class "Hobbit")}}selected{{/if}}>Hobbit</option>
                  <option value="Illusionist" {{#if (eq system.class "Illusionist")}}selected{{/if}}>Illusionist</option>
                  <option value="Knight" {{#if (eq system.class "Knight")}}selected{{/if}}>Knight</option>
                  <option value="Mage" {{#if (eq system.class "Mage")}}selected{{/if}}>Mage</option>
                  <option value="Magic-User" {{#if (eq system.class "Magic-User")}}selected{{/if}}>Magic-User</option>
                  <option value="Paladin" {{#if (eq system.class "Paladin")}}selected{{/if}}>Paladin</option>
                  <option value="Ranger" {{#if (eq system.class "Ranger")}}selected{{/if}}>Ranger</option>
                  <option value="Thief" {{#if (eq system.class "Thief")}}selected{{/if}}>Thief</option>
                  <option value="Warden" {{#if (eq system.class "Warden")}}selected{{/if}}>Warden</option>
                </select>
              </div>
              <div class="char-field-group" style="display: flex; flex-direction: column; align-items: center;">
                <label for="char-align" style="margin-bottom: 2px; text-align: center;">Alignment</label>
                <select class="char-align" id="char-align" name="system.alignment" style="width: 120px; height: 2em; text-align: center;">
                  <option value="Chaotic" {{#if (eq system.alignment "Chaotic")}}selected{{/if}}>Chaotic</option>
                  <option value="Lawful" {{#if (eq system.alignment "Lawful")}}selected{{/if}}>Lawful</option>
                  <option value="Neutral" {{#if (eq system.alignment "Neutral")}}selected{{/if}}>Neutral</option>
                </select>
              </div>
              <div class="char-field-group" style="display: flex; flex-direction: column; align-items: center;">
                <label for="char-level" style="margin-bottom: 2px; text-align: center;">Level</label>
                <select class="char-level" id="char-level" name="system.level" style="width: 60px; height: 2em; text-align: center;">
                  <option value="1" {{#if (eq system.level "1")}}selected{{/if}}>1</option>
                  <option value="2" {{#if (eq system.level "2")}}selected{{/if}}>2</option>
                  <option value="3" {{#if (eq system.level "3")}}selected{{/if}}>3</option>
                  <option value="4" {{#if (eq system.level "4")}}selected{{/if}}>4</option>
                  <option value="5" {{#if (eq system.level "5")}}selected{{/if}}>5</option>
                  <option value="6" {{#if (eq system.level "6")}}selected{{/if}}>6</option>
                  <option value="7" {{#if (eq system.level "7")}}selected{{/if}}>7</option>
                  <option value="8" {{#if (eq system.level "8")}}selected{{/if}}>8</option>
                  <option value="9" {{#if (eq system.level "9")}}selected{{/if}}>9</option>
                  <option value="10" {{#if (eq system.level "10")}}selected{{/if}}>10</option>
                  <option value="11" {{#if (eq system.level "11")}}selected{{/if}}>11</option>
                  <option value="12" {{#if (eq system.level "12")}}selected{{/if}}>12</option>
                  <option value="13" {{#if (eq system.level "13")}}selected{{/if}}>13</option>
                  <option value="14" {{#if (eq system.level "14")}}selected{{/if}}>14</option>
                </select>
              </div>
            </div>
            <div class="char-details" style="display: flex; gap: 1rem; flex-wrap: wrap;">
              <div class="char-field-group" style="display: flex; flex-direction: column; align-items: center;">
                <label for="char-xp" style="margin-bottom: 2px; text-align: center;">XP</label>
                <input class="char-xp" id="char-xp" name="system.xp" type="number" value="{{system.xp}}" style="width: 100px; height: 2em; text-align: center;" />
              </div>
              <div class="char-field-group" style="display: flex; flex-direction: column; align-items: center;">
                <label for="char-next-level" style="margin-bottom: 2px; text-align: center;">Next Level</label>
                <div class="char-next-level" style="width: 100px; height: 2em; text-align: center; display: flex; align-items: center; justify-content: center; background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 3px;">
                  {{getNextLevelXP system.class system.level}}
                </div>
              </div>
              <div class="char-field-group" style="display: flex; flex-direction: column; align-items: center;">
                <label for="char-xp-mod" style="margin-bottom: 2px; text-align: center;">XP Mod %</label>
                <div class="char-xp-mod" style="width: 80px; height: 2em; text-align: center; display: flex; align-items: center; justify-content: center; background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 3px;">
                  {{#with (getXPModifier system.class system.attributes)}}
                    {{#if (eq this 0)}}0{{else}}{{#if (gt this 0)}}+{{this}}{{else}}{{this}}{{/if}}{{/if}}%
                  {{/with}}
                </div>
              </div>
              <div class="char-field-group" style="display: flex; flex-direction: column; align-items: center;">
                <label for="char-background" style="margin-bottom: 2px; text-align: center;">Background</label>
                <input class="char-background" id="char-background" name="system.background" type="text" value="{{system.background}}" style="width: 140px; height: 2em; text-align: center;" />
              </div>
              <div class="char-field-group">
                <div style="display: flex; align-items: center; gap: 6px;">
                  <label for="char-languages" style="margin-bottom: 2px; text-align: left;">Languages</label>
                  <button type="button" class="open-language-dialog" title="Add Language"></button>
                </div>
                <div class="languages-row">
                  <div class="languages-tags"></div>
                </div>
                <input type="hidden" name="system.languages" class="char-languages" value="{{system.languages}}" />
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="tab" data-group="primary" data-tab="combat">
        <div class="combat-section">
          <h3>Ability Scores</h3>
          <div class="abilities" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 2rem;">
            <div class="ability" style="flex: 1 1 60px; display: flex; flex-direction: column; align-items: center;">
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                <span>STR</span>
                <div style="width: 24px; height: 24px; border-radius: 50%; background-color: #4a5568; color: white; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold;">
                  {{abilityMod system.attributes.str.value}}
                </div>
              </div>
              <select class="attr-str" id="attr-str" name="system.attributes.str.value" style="width: 100%; text-align: center;">
                {{#each (range 3 18) as |val|}}
                  <option value="{{val}}" {{#if (eq (parseInt ../system.attributes.str.value) val)}}selected{{/if}}>{{val}}</option>
                {{/each}}
              </select>
            </div>
            <div class="ability" style="flex: 1 1 60px; display: flex; flex-direction: column; align-items: center;">
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                <span>DEX</span>
                <div style="width: 24px; height: 24px; border-radius: 50%; background-color: #4a5568; color: white; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold;">
                  {{abilityMod system.attributes.dex.value}}
                </div>
              </div>
              <select class="attr-dex" id="attr-dex" name="system.attributes.dex.value" style="width: 100%; text-align: center;">
                {{#each (range 3 18) as |val|}}
                  <option value="{{val}}" {{#if (eq (parseInt ../system.attributes.dex.value) val)}}selected{{/if}}>{{val}}</option>
                {{/each}}
              </select>
            </div>
            <div class="ability" style="flex: 1 1 60px; display: flex; flex-direction: column; align-items: center;">
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                <span>CON</span>
                <div style="width: 24px; height: 24px; border-radius: 50%; background-color: #4a5568; color: white; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold;">
                  {{abilityMod system.attributes.con.value}}
                </div>
              </div>
              <select class="attr-con" id="attr-con" name="system.attributes.con.value" style="width: 100%; text-align: center;">
                {{#each (range 3 18) as |val|}}
                  <option value="{{val}}" {{#if (eq (parseInt ../system.attributes.con.value) val)}}selected{{/if}}>{{val}}</option>
                {{/each}}
              </select>
            </div>
            <div class="ability" style="flex: 1 1 60px; display: flex; flex-direction: column; align-items: center;">
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                <span>INT</span>
                <div style="width: 24px; height: 24px; border-radius: 50%; background-color: #4a5568; color: white; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold;">
                  {{abilityMod system.attributes.int.value}}
                </div>
              </div>
              <select class="attr-int" id="attr-int" name="system.attributes.int.value" style="width: 100%; text-align: center;">
                {{#each (range 3 18) as |val|}}
                  <option value="{{val}}" {{#if (eq (parseInt ../system.attributes.int.value) val)}}selected{{/if}}>{{val}}</option>
                {{/each}}
              </select>
            </div>
            <div class="ability" style="flex: 1 1 60px; display: flex; flex-direction: column; align-items: center;">
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                <span>WIS</span>
                <div style="width: 24px; height: 24px; border-radius: 50%; background-color: #4a5568; color: white; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold;">
                  {{abilityMod system.attributes.wis.value}}
                </div>
              </div>
              <select class="attr-wis" id="attr-wis" name="system.attributes.wis.value" style="width: 100%; text-align: center;">
                {{#each (range 3 18) as |val|}}
                  <option value="{{val}}" {{#if (eq (parseInt ../system.attributes.wis.value) val)}}selected{{/if}}>{{val}}</option>
                {{/each}}
              </select>
            </div>
            <div class="ability" style="flex: 1 1 60px; display: flex; flex-direction: column; align-items: center;">
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                <span>CHA</span>
                <div style="width: 24px; height: 24px; border-radius: 50%; background-color: #4a5568; color: white; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold;">
                  {{abilityMod system.attributes.cha.value}}
                </div>
              </div>
              <select class="attr-cha" id="attr-cha" name="system.attributes.cha.value" style="width: 100%; text-align: center;">
                {{#each (range 3 18) as |val|}}
                  <option value="{{val}}" {{#if (eq (parseInt ../system.attributes.cha.value) val)}}selected{{/if}}>{{val}}</option>
                {{/each}}
              </select>
            </div>
          </div>

          <h3>Saving Throws</h3>
          <div class="saving-throws" style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <div class="save" style="flex: 1 1 80px; display: flex; flex-direction: column; align-items: center;">
              <label style="margin-bottom: 0.25rem; font-weight: bold;">Death Ray / Poison</label>
              <div style="width: 40px; height: 40px; border: 2px solid #4a5568; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; background-color: #f7fafc;">
                {{saves.death.value}}
              </div>
            </div>
            <div class="save" style="flex: 1 1 80px; display: flex; flex-direction: column; align-items: center;">
              <label style="margin-bottom: 0.25rem; font-weight: bold;">Magic Wands</label>
              <div style="width: 40px; height: 40px; border: 2px solid #4a5568; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; background-color: #f7fafc;">
                {{saves.wands.value}}
              </div>
            </div>
            <div class="save" style="flex: 1 1 80px; display: flex; flex-direction: column; align-items: center;">
              <label style="margin-bottom: 0.25rem; font-weight: bold;">Paralysis / Turn to Stone</label>
              <div style="width: 40px; height: 40px; border: 2px solid #4a5568; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; background-color: #f7fafc;">
                {{saves.paralysis.value}}
              </div>
            </div>
            <div class="save" style="flex: 1 1 80px; display: flex; flex-direction: column; align-items: center;">
              <label style="margin-bottom: 0.25rem; font-weight: bold;">Dragon Breath</label>
              <div style="width: 40px; height: 40px; border: 2px solid #4a5568; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; background-color: #f7fafc;">
                {{saves.breath.value}}
              </div>
            </div>
            <div class="save" style="flex: 1 1 80px; display: flex; flex-direction: column; align-items: center;">
              <label style="margin-bottom: 0.25rem; font-weight: bold;">Rod / Staff / Spell</label>
              <div style="width: 40px; height: 40px; border: 2px solid #4a5568; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; background-color: #f7fafc;">
                {{saves.spells.value}}
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="tab" data-group="primary" data-tab="skills">
        <!-- Skills tab content (blank for now) -->
      </section>
      <section class="tab" data-group="primary" data-tab="equipment">
        <section class="equipment-tab">
          {{!-- Weapons Section --}}
          <div class="item-category">
            <div class="item-category-title flexrow">
              <div class="category-caret"><i class="fas fa-caret-down"></i></div>
              <div class="category-name">Weapons</div>
              <div class="field-short">Damage</div>
              <div class="field-short">Weight</div>
              <div class="item-controls">
                <a class="item-control item-create" data-type="weapon" title="Add Weapon">
                  <i class="fa fa-plus"></i>
                </a>
              </div>
            </div>
            <ol class="item-list">
              {{#each weapons as |item|}}
              <li class="item-entry item" data-item-id="{{item.id}}">
                <div class="item-header flexrow {{#if item.isWeapon}}item-rollable{{/if}}">
                  <div class="item-image" style="background-image: url({{item.img}})"></div>
                  <h4 class="item-name" title="{{item.name}}">{{item.name}}</h4>
                  <div class="field-short">{{item.system.damage}}</div>
                  <div class="field-short">{{item.system.weight}}</div>
                  <div class="item-controls">
                    {{#if @root.owner}}
                    <a class="item-control item-show" title="Show Item">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a class="item-control item-toggle {{#unless item.system.equipped}}item-unequipped{{/unless}}" title="Equip/Unequip">
                      <i class="fas fa-hand"></i>
                    </a>
                    <a class="item-control item-edit" title="Edit Item">
                      <i class="fas fa-edit"></i>
                    </a>
                    <a class="item-control item-delete" title="Delete Item">
                      <i class="fas fa-trash"></i>
                    </a>
                    {{/if}}
                  </div>
                </div>
                <div class="item-summary {{#if item.isExpanded}}expanded{{/if}}">
                  {{#if item.system.description}}
                  <div class="item-description">{{item.system.description}}</div>
                  {{/if}}
                  {{#if item.displayTags}}
                  <div class="item-tags">
                    {{#each item.displayTags as |tag|}}
                    <span class="tag">{{tag.value}}</span>
                    {{/each}}
                  </div>
                  {{/if}}
                </div>
              </li>
              {{/each}}
            </ol>
          </div>

          {{!-- Armor Section --}}
          <div class="item-category">
            <div class="item-category-title flexrow">
              <div class="category-caret"><i class="fas fa-caret-down"></i></div>
              <div class="category-name">Armor</div>
              <div class="field-short">AC</div>
              <div class="field-short">Weight</div>
              <div class="item-controls">
                <a class="item-control item-create" data-type="armor" title="Add Armor">
                  <i class="fa fa-plus"></i>
                </a>
              </div>
            </div>
            <ol class="item-list">
              {{#each armor as |item|}}
              <li class="item-entry item" data-item-id="{{item.id}}">
                <div class="item-header flexrow">
                  <div class="item-image" style="background-image: url({{item.img}})"></div>
                  <h4 class="item-name" title="{{item.name}}">{{item.name}}</h4>
                  <div class="field-short">{{item.system.ac.value}}</div>
                  <div class="field-short">{{item.system.weight}}</div>
                  <div class="item-controls">
                    {{#if @root.owner}}
                    <a class="item-control item-show" title="Show Item">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a class="item-control item-toggle {{#unless item.system.equipped}}item-unequipped{{/unless}}" title="Equip/Unequip">
                      <i class="fas fa-tshirt"></i>
                    </a>
                    <a class="item-control item-edit" title="Edit Item">
                      <i class="fas fa-edit"></i>
                    </a>
                    <a class="item-control item-delete" title="Delete Item">
                      <i class="fas fa-trash"></i>
                    </a>
                    {{/if}}
                  </div>
                </div>
                <div class="item-summary {{#if item.isExpanded}}expanded{{/if}}">
                  {{#if item.system.description}}
                  <div class="item-description">{{item.system.description}}</div>
                  {{/if}}
                </div>
              </li>
              {{/each}}
            </ol>
          </div>

          {{!-- Containers Section --}}
          <div class="item-category">
            <div class="item-category-title flexrow">
              <div class="category-caret"><i class="fas fa-caret-down"></i></div>
              <div class="category-name">Containers</div>
              <div class="field-short">Capacity</div>
              <div class="field-short">Weight</div>
              <div class="item-controls">
                <a class="item-control item-create" data-type="container" title="Add Container">
                  <i class="fa fa-plus"></i>
                </a>
              </div>
            </div>
            <ol class="item-list">
              {{#each containers as |item|}}
              <li class="item-entry item" data-item-id="{{item.id}}">
                <div class="item-header flexrow">
                  <div class="item-image" style="background-image: url({{item.img}})"></div>
                  <h4 class="item-name" title="{{item.name}}">{{item.name}}</h4>
                  <div class="field-short">{{item.system.capacity.value}}/{{item.system.capacity.max}}</div>
                  <div class="field-short">{{item.system.weight}}</div>
                  <div class="item-controls">
                    {{#if @root.owner}}
                    <a class="item-control item-show" title="Show Item">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a class="item-control item-toggle {{#unless item.system.equipped}}item-unequipped{{/unless}}" title="Equip/Unequip">
                      <i class="fas fa-hand"></i>
                    </a>
                    <a class="item-control item-edit" title="Edit Item">
                      <i class="fas fa-edit"></i>
                    </a>
                    <a class="item-control item-delete" title="Delete Item">
                      <i class="fas fa-trash"></i>
                    </a>
                    {{/if}}
                  </div>
                </div>
                <div class="item-summary {{#if item.isExpanded}}expanded{{/if}}">
                  {{#if item.system.description}}
                  <div class="item-description">{{item.system.description}}</div>
                  {{/if}}
                </div>
              </li>
              {{/each}}
            </ol>
          </div>

          {{!-- General Items Section --}}
          <div class="item-category">
            <div class="item-category-title flexrow">
              <div class="category-caret"><i class="fas fa-caret-down"></i></div>
              <div class="category-name">Items</div>
              <div class="field-short">Qty</div>
              <div class="field-short">Weight</div>
              <div class="item-controls">
                <a class="item-control item-create" data-type="item" title="Add Item">
                  <i class="fa fa-plus"></i>
                </a>
              </div>
            </div>
            <ol class="item-list">
              {{#each items as |item|}}
              <li class="item-entry item" data-item-id="{{item.id}}">
                <div class="item-header flexrow">
                  <div class="item-image" style="background-image: url({{item.img}})"></div>
                  <h4 class="item-name" title="{{item.name}}">{{item.name}}</h4>
                  <div class="field-short quantity">
                    <input 
                      value="{{item.system.quantity.value}}" 
                      type="number" 
                      min="0" 
                      data-field="system.quantity.value"
                      data-item-id="{{item.id}}"
                    />
                    {{#if item.system.quantity.max}}
                    <span>/{{item.system.quantity.max}}</span>
                    {{/if}}
                  </div>
                  <div class="field-short">{{multiply item.system.weight item.system.quantity.value}}</div>
                  <div class="item-controls">
                    {{#if @root.owner}}
                    <a class="item-control item-show" title="Show Item">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a class="item-control item-toggle {{#unless item.system.equipped}}item-unequipped{{/unless}}" title="Equip/Unequip">
                      <i class="fas fa-hand"></i>
                    </a>
                    <a class="item-control item-edit" title="Edit Item">
                      <i class="fas fa-edit"></i>
                    </a>
                    <a class="item-control item-delete" title="Delete Item">
                      <i class="fas fa-trash"></i>
                    </a>
                    {{/if}}
                  </div>
                </div>
                <div class="item-summary {{#if item.isExpanded}}expanded{{/if}}">
                  {{#if item.system.description}}
                  <div class="item-description">{{item.system.description}}</div>
                  {{/if}}
                </div>
              </li>
              {{/each}}
            </ol>
          </div>

          {{!-- Treasure Section --}}
          <div class="item-category">
            <div class="item-category-title flexrow">
              <div class="category-caret"><i class="fas fa-caret-down"></i></div>
              <div class="category-name">Treasure</div>
              <div class="field-short">Value</div>
              <div class="field-short">Weight</div>
              <div class="item-controls">
                <a class="item-control item-create" data-type="item" data-treasure="true" title="Add Treasure">
                  <i class="fa fa-plus"></i>
                </a>
              </div>
            </div>
            <ol class="item-list">
              {{#each treasures as |item|}}
              <li class="item-entry item" data-item-id="{{item.id}}">
                <div class="item-header flexrow">
                  <div class="item-image" style="background-image: url({{item.img}})"></div>
                  <h4 class="item-name" title="{{item.name}}">{{item.name}}</h4>
                  <div class="field-short">{{item.system.cumulativeCost}} gp</div>
                  <div class="field-short">{{item.system.cumulativeWeight}}</div>
                  <div class="item-controls">
                    {{#if @root.owner}}
                    <a class="item-control item-show" title="Show Item">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a class="item-control item-edit" title="Edit Item">
                      <i class="fas fa-edit"></i>
                    </a>
                    <a class="item-control item-delete" title="Delete Item">
                      <i class="fas fa-trash"></i>
                    </a>
                    {{/if}}
                  </div>
                </div>
                <div class="item-summary {{#if item.isExpanded}}expanded{{/if}}">
                  {{#if item.system.description}}
                  <div class="item-description">{{item.system.description}}</div>
                  {{/if}}
                </div>
              </li>
              {{/each}}
            </ol>
          </div>

          {{!-- Encumbrance Bar --}}
          <section class="encumbrance-section">
            <div class="encumbrance-label">Encumbrance</div>
            <div class="encumbrance-bar-container">
              <div class="encumbrance-bar" style="width: {{encumbrancePercentage}}%"></div>
              <span class="encumbrance-text">{{totalWeight}} / {{maxWeight}} lbs</span>
            </div>
          </section>
        </section>
      </section>
    </div>
  </div>
</form>