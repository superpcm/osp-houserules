// ...existing code...

// Place after $cs-pos-listening-top is defined
/* Character sheet specific styles extracted from templates/actors/character-sheet.html
   Migrate presentation out of the template and into this partial. */

/* ================================================================
   DEBUG CONFIGURATION
   ================================================================
   
   Uncomment the sections below to enable visual debugging for specific
   components. These should be commented out in production.
   
   ================================================================ */

/* Form Field Debug - Master Switch */
/* Uncomment the line below to enable red dashed borders on all form fields */
$debug-form-fields: false; // Change to false to disable

/* Form Field Debug - Controlled by $debug-form-fields variable */
@if $debug-form-fields {
  input, select, textarea, button {
    border: 0.5px dashed red !important;
  }
  
  /* Additional form field types */
  .cs-char-name,
  .cs-class-select,
  .cs-background-select,
  .cs-race-select,
  .cs-alignment-select,
  .cs-age-field,
  .cs-sex-field,
  .cs-height-field,
  .cs-weight-field,
  .char-height,
  .char-weight,
  .cs-languages-field,
  .languages-tags,
  .char-languages,
  .cs-input-small,
  .cs-input-medium,
  .cs-select-inline,
  .cs-listening-select,
  .cs-bio-textarea,
  .cs-ability-select,
  .attr-str,
  .attr-dex,
  .attr-con,
  .attr-int,
  .attr-wis,
  .attr-cha,
  .cs-save-value,
  .cs-save-badge,
  .cs-combat-input,
  .cs-portrait-img,
  .portrait-img,
  .cs-portrait-display,
  .portrait-display,
  .cs-level-display,
  .cs-xp-display,
  .cs-xp-mod-display,
  .cs-next-level-field {
    border: 0.5px dashed red !important;
  }
  
  /* High specificity rules for stubborn elements */
  .osp.sheet.actor.character {
    input[name*="height"],
    input[name*="weight"],
    input[name*="languages"],
    select[name*="attributes"],
    .attr-str,
    .attr-dex,
    .attr-con,
    .attr-int,
    .attr-wis,
    .attr-cha {
      border: 0.5px dashed red !important;
    }
  }
  
  /* Position Adjustment Tool - Clean, modern styling */
  .cs-position-tool {
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    background: #2a2a2a !important;
    border: 2px solid #444 !important;
    border-radius: 8px !important;
    padding: 15px !important;
    color: #fff !important;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
    font-size: 12px !important;
    z-index: 99999 !important;
    min-width: 320px !important;
    max-width: 400px !important;
    max-height: 80vh !important;
    overflow-y: auto !important;
    box-shadow: 0 8px 32px rgba(0,0,0,0.8) !important;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    
    .tool-header {
      background: #333 !important;
      margin: -15px -15px 15px -15px !important;
      padding: 12px 15px !important;
      border-radius: 6px 6px 0 0 !important;
      border-bottom: 1px solid #555 !important;
      font-weight: bold !important;
      display: flex !important;
      justify-content: space-between !important;
      align-items: center !important;
      color: #fff !important;
      
      .close-btn {
        background: #e74c3c !important;
        color: white !important;
        border: none !important;
        border-radius: 3px !important;
        padding: 4px 8px !important;
        cursor: pointer !important;
        font-size: 12px !important;
        font-weight: bold !important;
        
        &:hover {
          background: #c0392b !important;
        }
      }
    }
    
    .tool-section {
      margin-bottom: 15px !important;
      
      .section-title {
        color: #bbb !important;
        margin-bottom: 8px !important;
        font-size: 11px !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
        font-weight: bold !important;
      }
      
      .controls {
        display: grid !important;
        grid-template-columns: 60px auto 60px 80px !important;
        gap: 8px !important;
        align-items: center !important;
        margin-bottom: 6px !important;
        
        .control-label {
          color: #ccc !important;
          font-weight: 500 !important;
        }
        
        .control-buttons {
          display: flex !important;
          gap: 4px !important;
          justify-content: center !important;
          
          button {
            background: #444 !important;
            color: #fff !important;
            border: 1px solid #666 !important;
            border-radius: 4px !important;
            padding: 6px 10px !important;
            cursor: pointer !important;
            font-size: 12px !important;
            font-weight: bold !important;
            min-width: 30px !important;
            
            &:hover {
              background: #555 !important;
              border-color: #777 !important;
            }
            
            &:active {
              background: #333 !important;
            }
          }
        }
        
        .control-input {
          background: #333 !important;
          color: #fff !important;
          border: 1px solid #666 !important;
          border-radius: 4px !important;
          padding: 6px 8px !important;
          font-size: 12px !important;
          width: 100% !important;
          text-align: center !important;
          
          &:focus {
            outline: none !important;
            border-color: #4CAF50 !important;
            background: #444 !important;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2) !important;
          }
        }
        
        .control-value {
          color: #4CAF50 !important;
          font-weight: bold !important;
          text-align: right !important;
          font-size: 12px !important;
        }
      }
    }
    
    .tool-footer {
      border-top: 1px solid #555 !important;
      padding-top: 12px !important;
      margin-top: 15px !important;
      text-align: center !important;
      display: flex !important;
      gap: 8px !important;
      justify-content: center !important;
      
      button {
        border: none !important;
        border-radius: 4px !important;
        padding: 8px 16px !important;
        cursor: pointer !important;
        font-size: 12px !important;
        font-weight: 500 !important;
        
        &:hover {
          transform: translateY(-1px) !important;
          box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }
      }
      
      .save-btn {
        background: #27ae60 !important;
        color: white !important;
        
        &:hover {
          background: #229954 !important;
        }
      }
      
      .reset-btn {
        background: #f39c12 !important;
        color: white !important;
        
        &:hover {
          background: #e67e22 !important;
        }
      }

      .toggle-btn {
        background: #2196F3 !important;
        color: white !important;
        
        &:hover {
          background: #1976D2 !important;
        }
      }
    }
  }
}

/* ================================================================
   END DEBUG CONFIGURATION
   ================================================================ */

/* Shared positioning variables */
$cs-header-row-top: 5px !default; // Shared y-coordinate for main header fields (Name, Class, Level, XP Mod)

/* Centralized position variables - change these to tweak sheet layout globally */
$cs-pos-level-left: 463px !default;
$cs-pos-level-top: 18px !default;
$cs-pos-portrait-left: 46px !default;
$cs-pos-portrait-top: 71px !default;
$cs-pos-languages-left: 323px !default;
$cs-pos-languages-top: 173px !default;
$cs-pos-xpmod-left: 531px !default;
$cs-pos-xpmod-top: 14px !default;
$cs-pos-xp-left: 323px !default;
$cs-pos-xp-top: 67px !default;
$cs-pos-next-left: 462px !default;
$cs-pos-next-top: 68px !default;

/* Additional header / field position presets discovered during sweep */
$cs-pos-namegroup-left: 44px !default;
$cs-pos-namegroup-top: 14px !default;
$cs-pos-class-left: 323px !default;
$cs-pos-class-top: 14px !default;
$cs-pos-alignment-left: 324px !default;
$cs-pos-alignment-top: 120px !default;
$cs-pos-race-left: 186px !default;
$cs-pos-race-top: 67px !default;
$cs-pos-age-left: 186px !default;
$cs-pos-age-top: 120px !default;
$cs-pos-sex-left: 255px !default;
$cs-pos-sex-top: 120px !default;
$cs-pos-height-left: 186px !default;
$cs-pos-height-top: 173px !default;
$cs-pos-weight-left: 250px !default;
$cs-pos-weight-top: 173px !default;
$cs-pos-background-left: 462px !default;
$cs-pos-background-top: 120px !default;
$cs-pos-listening-left: -6px !default;
$cs-pos-listening-top: 304px !default;
$cs-pos-listening-width: 60px !default;
$cs-pos-listening-height: 30px !default;
$cs-pos-find-secret-door-left: 60px !default;
$cs-pos-find-secret-door-top: 304px !default;
$cs-pos-find-secret-door-width: 60px !default;
$cs-pos-find-secret-door-height: 30px !default;
.cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left}; --top: #{$cs-pos-find-secret-door-top}; --width: #{$cs-pos-find-secret-door-width}; --height: #{$cs-pos-find-secret-door-height}; --z: var(--z-labels, 15); }
$cs-pos-open-stuck-doors-left: 126px !default;
$cs-pos-open-stuck-doors-top: 304px !default;
$cs-pos-open-stuck-doors-width: 60px !default;
$cs-pos-open-stuck-doors-height: 30px !default;
.cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left}; --top: #{$cs-pos-open-stuck-doors-top}; --width: #{$cs-pos-open-stuck-doors-width}; --height: #{$cs-pos-open-stuck-doors-height}; --z: var(--z-labels, 15); }
$cs-pos-detect-construction-left: 190px !default;
$cs-pos-detect-construction-top: 304px !default;
$cs-pos-detect-construction-width: 60px !default;
$cs-pos-detect-construction-height: 30px !default;
.cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left}; --top: #{$cs-pos-detect-construction-top}; --width: #{$cs-pos-detect-construction-width}; --height: #{$cs-pos-detect-construction-height}; --z: var(--z-labels, 15); }
$cs-pos-detect-room-traps-left: 256px !default;
$cs-pos-detect-room-traps-top: 304px !default;
$cs-pos-detect-room-traps-width: 60px !default;
$cs-pos-detect-room-traps-height: 30px !default;
.cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left}; --top: #{$cs-pos-detect-room-traps-top}; --width: #{$cs-pos-detect-room-traps-width}; --height: #{$cs-pos-detect-room-traps-height}; --z: var(--z-labels, 15); }
$cs-pos-barbarian-climb-left: 322px !default;
$cs-pos-barbarian-climb-top: 190px !default;
$cs-pos-barbarian-climb-width: 60px !default;
$cs-pos-barbarian-climb-height: 30px !default;
.cs-pos-barbarian-climb { --left: #{$cs-pos-barbarian-climb-left}; --top: #{$cs-pos-barbarian-climb-top}; --width: #{$cs-pos-barbarian-climb-width}; --height: #{$cs-pos-barbarian-climb-height}; --z: var(--z-labels, 15); }
$cs-pos-barbarian-hide-left: 388px !default;
$cs-pos-barbarian-hide-top: 256px !default;
$cs-pos-barbarian-hide-width: 60px !default;
$cs-pos-barbarian-hide-height: 30px !default;
.cs-pos-barbarian-hide { --left: #{$cs-pos-barbarian-hide-left}; --top: #{$cs-pos-barbarian-hide-top}; --width: #{$cs-pos-barbarian-hide-width}; --height: #{$cs-pos-barbarian-hide-height}; --z: var(--z-labels, 15); }
$cs-pos-barbarian-move-left: 454px !default;
$cs-pos-barbarian-move-top: 322px !default;
$cs-pos-barbarian-move-width: 60px !default;
$cs-pos-barbarian-move-height: 30px !default;
.cs-pos-barbarian-move { --left: #{$cs-pos-barbarian-move-left}; --top: #{$cs-pos-barbarian-move-top}; --width: #{$cs-pos-barbarian-move-width}; --height: #{$cs-pos-barbarian-move-height}; --z: var(--z-labels, 15); }

/* Skill Target Position Variants - Adjusts positions based on race/class layout */
/* Class-based position adjustments (take priority over race) */
.skill-layout-assassin {
  .cs-pos-listening { --left: #{$cs-pos-listening-left - 20px}; }
  .cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left - 20px}; }
  .cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left - 20px}; }
  .cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left - 20px}; }
  .cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left - 20px}; }
  .cs-pos-barbarian-climb { --left: #{$cs-pos-barbarian-climb-left - 20px}; }
  .cs-pos-barbarian-hide { --left: #{$cs-pos-barbarian-hide-left - 20px}; }
  .cs-pos-barbarian-move { --left: #{$cs-pos-barbarian-move-left - 20px}; }
}

.skill-layout-barbarian {
  .cs-pos-listening { --left: #{$cs-pos-listening-left + 20px}; }
  .cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left + 20px}; }
  .cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left + 20px}; }
  .cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left + 20px}; }
  .cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left + 20px}; }
  .cs-pos-barbarian-climb { --left: #{$cs-pos-barbarian-climb-left + 20px}; }
  .cs-pos-barbarian-hide { --left: #{$cs-pos-barbarian-hide-left + 20px}; }
  .cs-pos-barbarian-move { --left: #{$cs-pos-barbarian-move-left + 20px}; }
}

.skill-layout-thief {
  .cs-pos-listening { --left: #{$cs-pos-listening-left - 40px}; }
  .cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left - 40px}; }
  .cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left - 40px}; }
  .cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left - 40px}; }
  .cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left - 40px}; }
  .cs-pos-barbarian-climb { --left: #{$cs-pos-barbarian-climb-left - 40px}; }
  .cs-pos-barbarian-hide { --left: #{$cs-pos-barbarian-hide-left - 40px}; }
  .cs-pos-barbarian-move { --left: #{$cs-pos-barbarian-move-left - 40px}; }
}

/* Race-based position adjustments (only if no qualifying class) */
.skill-layout-dwarf {
  .cs-pos-listening { --left: #{$cs-pos-listening-left + 40px}; }
  .cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left + 40px}; }
  .cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left + 40px}; }
  .cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left + 40px}; }
  .cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left + 40px}; }
  .cs-pos-barbarian-climb { --left: #{$cs-pos-barbarian-climb-left + 40px}; }
  .cs-pos-barbarian-hide { --left: #{$cs-pos-barbarian-hide-left + 40px}; }
  .cs-pos-barbarian-move { --left: #{$cs-pos-barbarian-move-left + 40px}; }
}

.skill-layout-gnome {
  .cs-pos-listening { --left: #{$cs-pos-listening-left + 60px}; }
  .cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left + 60px}; }
  .cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left + 60px}; }
  .cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left + 60px}; }
  .cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left + 60px}; }
  .cs-pos-barbarian-climb { --left: #{$cs-pos-barbarian-climb-left + 60px}; }
  .cs-pos-barbarian-hide { --left: #{$cs-pos-barbarian-hide-left + 60px}; }
  .cs-pos-barbarian-move { --left: #{$cs-pos-barbarian-move-left + 60px}; }
}

.skill-layout-halforc {
  .cs-pos-listening { --left: #{$cs-pos-listening-left - 80px}; }
  .cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left - 80px}; }
  .cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left - 80px}; }
  .cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left - 80px}; }
  .cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left - 80px}; }
  .cs-pos-barbarian-climb { --left: #{$cs-pos-barbarian-climb-left - 80px}; }
  .cs-pos-barbarian-hide { --left: #{$cs-pos-barbarian-hide-left - 80px}; }
  .cs-pos-barbarian-move { --left: #{$cs-pos-barbarian-move-left - 80px}; }
}

.skill-layout-hobbit {
  .cs-pos-listening { --left: #{$cs-pos-listening-left - 60px}; }
  .cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left - 60px}; }
  .cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left - 60px}; }
  .cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left - 60px}; }
  .cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left - 60px}; }
  .cs-pos-barbarian-climb { --left: #{$cs-pos-barbarian-climb-left - 60px}; }
  .cs-pos-barbarian-hide { --left: #{$cs-pos-barbarian-hide-left - 60px}; }
  .cs-pos-barbarian-move { --left: #{$cs-pos-barbarian-move-left - 60px}; }
}

/* Special race + class combinations */
.skill-layout-dwarf-thief {
  .cs-pos-listening { --left: #{$cs-pos-listening-left + 30px}; }
  .cs-pos-find-secret-door { --left: #{$cs-pos-find-secret-door-left + 30px}; }
  .cs-pos-open-stuck-doors { --left: #{$cs-pos-open-stuck-doors-left + 30px}; }
  .cs-pos-detect-construction { --left: #{$cs-pos-detect-construction-left + 30px}; }
  .cs-pos-detect-room-traps { --left: #{$cs-pos-detect-room-traps-left + 30px}; }
  .cs-pos-barbarian-climb { --left: #{$cs-pos-barbarian-climb-left + 30px}; }
  .cs-pos-barbarian-hide { --left: #{$cs-pos-barbarian-hide-left + 30px}; }
  .cs-pos-barbarian-move { --left: #{$cs-pos-barbarian-move-left + 30px}; }
}

/* Generic fallback layout (default positioning when no other conditions are met) */
.skill-layout-generic {
  /* Uses default positioning - ensures consistent class-based approach */
  position: relative;
}

/* Background Image Override - Apply to entire sheet and window */
form.osp.sheet.actor.character,
.osp.sheet.actor.character,
.application.window-app.sheet.actor.character.osp,
.application.window-app.sheet.actor.character.osp .window-content,
.window-content form.osp.sheet.actor.character,
.window-content .osp.sheet.actor.character,
.window-content .window-content form.osp.sheet.actor.character,
.osp .window-content {
  background: url('/systems/osp-houserules/assets/backgrounds/osp-parchment-background.webp') no-repeat center center !important;
  background-size: 100% !important;
  background-attachment: scroll !important;
  columns: #704214;
}

/* Single Background Image System - Applied to window instead of form */
form.osp.sheet.actor.character {
  position: relative;
}

/* Ensure the application window allows tabs to extend beyond right edge */
.application.window-app.sheet.actor.character.osp {
  overflow: visible !important;
}

/* Prevent accidental stacking-contexts on ancestors which can break z-index ordering */
.application.window-app.sheet.actor.character.osp,
.application.window-app.sheet.actor.character.osp .window-content,
.osp.sheet.actor.character,
.window-content,
.window-content .window-content,
.osp .window-content,
form.osp.sheet.actor.character {
  transform: none !important;
  opacity: 1 !important;
  filter: none !important;
  will-change: auto !important;
  backface-visibility: visible !important;
}

/* Window content wrapper - inherits background from main declaration above */
.application.window-app.sheet.actor.character.osp .window-content,
.osp .window-content {
  /* Background already set by main rule above */
  padding: 0 !important;
  overflow: visible !important;
}

/* Black title bar for character sheet window */
.application.window-app.sheet.actor.character.osp .window-header,
.osp .window-header {
  background: black !important;
  background-color: black !important;
  border-bottom: 1px solid #333 !important;
}

.application.window-app.sheet.actor.character.osp .window-header .window-title,
.osp .window-header .window-title { color: white !important; }
.application.window-app.sheet.actor.character.osp .window-header .header-button,
.osp .window-header .header-button { color: white !important; }
.application.window-app.sheet.actor.character.osp .window-header .header-button:hover,
.osp .window-header .header-button:hover { background: rgba(255,255,255,0.2) !important; }

/* XP progress bar */
form.osp.sheet.actor.character .xp-progress-bar,
.osp.sheet.actor.character .xp-progress-bar { background-color: #4a90e2 !important; }

/* Static header - consolidated background image and layout properties */
form.osp.sheet.actor.character .static-header,
.static-header,
.cs-static-header {
  background: url('/systems/osp-houserules/assets/character-sheet/header.webp') no-repeat !important;
  background-position: left top !important;
  background-size: contain !important;
  background-color: transparent !important;
  height: 220px !important;
  z-index: var(--z-sheet, 10);
  margin: 4px 3.6px 0px 0.8px !important;
}

/* FORCE OVERRIDE: Semi-transparent tabs to show parchment background */
form.osp.sheet.actor.character .sheet-tabs a.item,
.osp.sheet.actor.character .sheet-tabs a.item,
.sheet.actor.character .sheet-tabs a.item { 
  opacity: 1 !important; 
  background: rgba(139, 123, 101, 0.4) !important; /* Semi-transparent brown to blend with parchment */
  box-shadow: none !important;
  position: relative !important;
  z-index: 10 !important;
}

form.osp.sheet.actor.character .sheet-tabs a.item:hover,
.osp.sheet.actor.character .sheet-tabs a.item:hover,
.sheet.actor.character .sheet-tabs a.item:hover { 
  opacity: 1 !important; 
  background: rgba(139, 123, 101, 0.6) !important; /* Slightly more opaque on hover */
  z-index: 15 !important;
}

form.osp.sheet.actor.character .sheet-tabs a.item.active,
.osp.sheet.actor.character .sheet-tabs a.item.active,
.sheet.actor.character .sheet-tabs a.item.active { 
  opacity: 1 !important; 
  background: rgba(255, 255, 255, 0.8) !important; /* More opaque white for active tab */
  z-index: 20 !important;
  border-left: none !important;
}

/* Tab content area */
.sheet-body .tab { display: none; background: none !important; border: none !important; margin-top: -5px !important; }
.sheet-body .tab.active { display: block; }

/* Height/Weight neutralization */
.char-height, .char-weight { box-shadow: none !important; background: transparent !important; border: none !important; border-radius: 0 !important; outline: none !important; }
.height-group, .weight-group { box-shadow: none !important; background: transparent !important; border: none !important; outline: none !important; }

/* XP Award Button */
button.xp-award-btn { color: #704214 !important; background: none !important; border: none !important; outline: none !important; box-shadow: none !important; }
button.xp-award-btn:hover, button.xp-award-btn:focus { color: #8B4513 !important; }

/* Portrait transform */
.portrait-img { transform: scale(var(--user-portrait-scale, 1)) translate(var(--user-portrait-x, 0px), var(--user-portrait-y, 0px)); transform-origin: center center; transition: transform 0.2s ease; }

.portrait-controls { position: absolute; top: 100%; left: 0; margin-top: 5px; background: rgba(0,0,0,0.95); color: white; padding: 3px; border-radius: 3px; display: none; z-index: var(--z-overlay, 1000); font-size: 10px; white-space: nowrap; border: 1px solid #666; box-shadow: 0 2px 4px rgba(0,0,0,0.5); }
.portrait-controls[style*="display: block"] { display: block !important; visibility: visible !important; opacity: 1 !important; }
.portrait-controls button { background: #555; color: white; border: 1px solid #777; padding: 2px 4px; margin: 1px; border-radius: 2px; cursor: pointer; font-size: 10px; width: 18px; height: 18px; line-height: 14px; display: inline-block; text-align: center; box-sizing: border-box; }
.portrait-controls button:hover { background: #777; border-color: #999; }
.portrait-controls button:active { background: #333; }
.portrait-controls .btn-group { display: inline-block; margin: 0 2px; vertical-align: top; }
.portrait-controls .btn-group:not(:last-child) { border-right: 1px solid #777; padding-right: 3px; }
.portrait-container.adjusting { outline: 1px dashed #00aaff; overflow: visible !important; z-index: calc(var(--z-overlay, 1000) + 1) !important; }

/* Tooltip classes to replace JS-injected cssText */
.cs-tooltip { 
  position: absolute; 
  background: #333; 
  color: white; 
  padding: 8px 12px; 
  border-radius: 4px; 
  font-size: 12px; 
  line-height: 1.4; 
  z-index: var(--z-overlay, 1000); 
  pointer-events: none; 
  opacity: 0; 
  transition: opacity 0.2s; 
  white-space: nowrap;
  
  /* Auto-hide animation for stuck tooltips */
  animation: tooltip-auto-hide 3s ease-out forwards;
}

@keyframes tooltip-auto-hide {
  0% { opacity: var(--tooltip-opacity, 0); }
  20% { opacity: var(--tooltip-opacity, 0); }
  80% { opacity: var(--tooltip-opacity, 0); }
  100% { opacity: 0 !important; }
}

.cs-tooltip--xp { box-shadow: 0 2px 8px rgba(0,0,0,0.3); z-index: var(--z-top, 10000); }
.cs-tooltip--portrait { box-shadow: 0 2px 8px rgba(0,0,0,0.3); z-index: var(--z-top, 10000); }
.cs-tooltip--ability { 
  box-shadow: 0 2px 8px rgba(0,0,0,0.3); 
  z-index: var(--z-top, 10000); 
  pointer-events: none !important;
  
  /* Faster auto-hide for ability tooltips since they're more prone to sticking */
  animation: tooltip-auto-hide-fast 2s ease-out forwards;
}

@keyframes tooltip-auto-hide-fast {
  0% { opacity: var(--tooltip-opacity, 0); }
  10% { opacity: var(--tooltip-opacity, 0); }
  70% { opacity: var(--tooltip-opacity, 0); }
  100% { opacity: 0 !important; }
}

/* Dialog helper used by XP award dialog to centralize its presentation */
.cs-xp-dialog { background: white !important; }
.cs-xp-dialog .window-header { background: black !important; color: white !important; }
.cs-xp-dialog .window-content { background: white !important; }

/* Dialog layout and control helpers for handler-generated markup */
.cs-xp-dialog-container { padding: 10px; }
.cs-xp-row { margin-bottom: 20px; text-align: center; }
.cs-xp-inline { margin-bottom: 10px; display: flex; align-items: center; gap: 8px; justify-content: center; }
.cs-xp-flex { display: flex; gap: 20px; }
.cs-xp-col { flex: 1; }
.cs-input-small { width: 60px; padding: 5px; background-color: white; border: 1px solid black; border-radius: 9px; box-shadow: none !important; text-align: center; color: #704214 !important; }
.cs-input-medium { width: 80px; padding: 5px; background-color: white; border: 1px solid black; border-radius: 9px; box-shadow: none !important; text-align: center; color: #704214 !important; }
.cs-no-border { border: none; background: none; color: inherit; padding: 0; }
.cs-xp-preview { margin-top: 15px; padding: 8px; background: #f5f5f5; border-radius: 3px; display: none; }

/* XP dialog side column helpers (replaces small inline wrappers) */
.cs-xp-side { flex: 1; display: flex; flex-direction: column; justify-content: center; }
.cs-xp-side-row { margin-bottom: 10px; display: flex; align-items: center; gap: 8px; justify-content: center; }

/* Reusable small select style for inline dialogs (appearance reset handled elsewhere) */
.cs-select-inline { width: 60px; padding: 5px; background-color: white; border: 1px solid black; border-radius: 9px; box-shadow: none !important; text-align: center; line-height: 1.2; appearance: none; -webkit-appearance: none; -moz-appearance: none; color: #704214 !important; }

/* Language dialog helpers */
.cs-dialog-row { margin-bottom: 8px; }
.cs-dialog-columns { display: flex; gap: 40px; }
.cs-dialog-column { display: flex; flex-direction: column; align-items: flex-start; gap: 6px; }
.cs-custom-input { width: 145px; }
.cs-dialog-label { display: flex; align-items: center; gap: 8px; }

/* Level & portrait container utility classes (migrate inline box-shadow/positioning into class-based rules) */
.cs-level-container { position: absolute; width: 64px; height: 34px; }
.cs-level-shadow { position: absolute; top: 0; left: 0; width: 64px; height: 34px; z-index: var(--z-labels, 15); pointer-events: none; box-shadow: none !important; border-radius: 6px; }

/* Combat and ability layouts markup helpers */
.cs-combat-stats { display: flex; gap: 1.5rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }
.cs-combat-stat { display: flex; flex-direction: column; align-items: center; }
.cs-save-badge { border: none !important; border-radius: 0 !important; background-color: transparent !important; position: relative; box-shadow: none !important; width: auto !important; height: auto !important; }

/* Ability score box */
.cs-ability-select {
  @extend %visual-center-large;
  @extend %single-character-center;
  @extend %round-container-center;
  @extend %numeric-center;
  
  width: 75px;
  height: 85px;
  font-size: 100px;
  font-weight: normal;
  color: #704214 !important;
  appearance: none;
  box-shadow: none !important;
  border: none !important;
  background: transparent !important;
  position: relative; /* Ensure proper positioning context */
  z-index: var(--z-labels, 15); /* Ensure tooltips work properly */
  pointer-events: auto; /* Ensure mouse events work */
}

/* NOTE: Old .cs-ability positioning removed - now uses simplified system at bottom of file */

/* Hide tooltips when dropdown is active/focused */
.cs-ability-select:focus ~ .cs-tooltip,
.cs-ability-select:active ~ .cs-tooltip,
.cs-ability-select:focus-within ~ .cs-tooltip {
  opacity: 0 !important;
  visibility: hidden !important;
  animation: none !important;
}

/* Hide tooltips when any dropdown in the ability section is open */
.ability-scores-section:focus-within .cs-tooltip {
  opacity: 0 !important;
  visibility: hidden !important;
  animation: none !important;
}

/* Individual ability X positioning - customize these left coordinates as needed */
.ability:has(.attr-str) { 
  --ability-left: 4px !important;
}

.ability:has(.attr-int) { 
  --ability-left: 103px !important;
}

.ability:has(.attr-wis) { 
  --ability-left: 205px !important;
}

.ability:has(.attr-dex) { 
  --ability-left: 305px !important;
}

.ability:has(.attr-con) { 
  --ability-left: 404px !important;
}

.ability:has(.attr-cha) { 
  --ability-left: 502px !important;
}

/* Listening at Doors field styling */
.listening-group {
  z-index: var(--z-labels, 15);
  pointer-events: auto;
}

/* Hide Barbarian skill fields by default - JavaScript will show them when needed */
.cs-pos-barbarian-climb,
.cs-pos-barbarian-hide,
.cs-pos-barbarian-move {
  display: none;
}

.listening-group .cs-field-label {
  display: none !important;
}

.cs-listening-select {
  @extend %input-visual-center;
  @extend %visual-center-medium;
  
  width: 80px;
  height: 80px;
  font-size: 60px;
  background-color: transparent !important;
  box-shadow: none !important;
  appearance: none;
  margin: 0;
  border: none !important;
  pointer-events: auto;
  text-align: center;
  color: #704214 !important;
}

.cs-listening-select:disabled {
  color: #704214;
  cursor: not-allowed;
}

/* Tabs helper (in case nav items had inline styles) */
.cs-tabs { display: flex; flex-direction: column; }
.cs-tab-item { 
  opacity: 1 !important; 
  background: rgba(139, 123, 101, 0.4) !important; /* Semi-transparent to show parchment */
  box-shadow: none !important; 
}

/* Tabs runtime helpers */
.cs-tabs {
  position: relative !important;
  z-index: var(--z-top, 10000) !important;
  pointer-events: auto !important;
  top: var(--tabs-top, auto);
}
.cs-tab-item {
  position: relative !important;
  z-index: 10 !important; /* Base tab layer */
  pointer-events: auto !important;
  cursor: pointer !important;
}

/* Active tab state for cs-tab-item */
.cs-tab-item.active {
  z-index: 20 !important; /* Active tab comes forward */
  border-left: none !important; /* Seamless connection to page */
  background: rgba(255, 255, 255, 0.8) !important; /* More opaque for active tab */
}

/* Hover state for cs-tab-item */
.cs-tab-item:hover {
  z-index: 15 !important; /* Hover tab comes slightly forward */
  background: rgba(139, 123, 101, 0.6) !important; /* Slightly more opaque on hover */
}
.cs-force-pointer { pointer-events: auto !important; }

/* ================================================================
   VISUAL TEXT CENTERING SYSTEM
   ================================================================
   
   This system provides precise text centering that accounts for both
   mathematical and visual weight. Different font sizes and characters
   require different compensation for optimal visual centering.
   
   ================================================================ */

/* Base centering mixin applied to all centered fields */
%visual-center-base {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  line-height: 1;
  box-sizing: border-box;
  
  /* Reset any inherited text transformations */
  text-indent: 0;
  text-transform: none;
  
  /* Ensure consistent baseline alignment */
  vertical-align: baseline;
}

/* Size-specific visual adjustments for Handwritten font */
%visual-center-large {
  @extend %visual-center-base;
  
  /* Large text (40px+) - account for descender visual weight */
  transform: translateY(-0.02em);
  letter-spacing: -0.01em;
  
  /* Optical adjustment for rounded/circular containers */
  &.in-circle {
    transform: translateY(-0.05em);
  }
}

%visual-center-medium {
  @extend %visual-center-base;
  
  /* Medium text (20-39px) - subtle baseline adjustment */
  transform: translateY(-0.01em);
  letter-spacing: 0;
  
  /* Adjustment for serif fonts at medium sizes */
  &.serif-adjust {
    transform: translateY(0.02em);
  }
}

%visual-center-small {
  @extend %visual-center-base;
  
  /* Small text (12-19px) - minimal adjustment */
  transform: translateY(0);
  letter-spacing: 0.01em;
}

/* Specific adjustments for common number/character types */
%numeric-center {
  /* Numbers often need slight upward adjustment */
  transform: translateY(-0.03em);
  
  /* Monospace-like spacing for consistency */
  font-variant-numeric: tabular-nums;
}

%single-character-center {
  /* Single characters (ability scores, etc.) */
  font-weight: normal;
  
  /* Prevent character distortion */
  font-synthesis: none;
}

/* Input field specific centering (accounts for border/padding visual weight) */
%input-visual-center {
  @extend %visual-center-base;
  
  /* Ensure text cursor appears centered */
  &:focus {
    text-align: center;
  }
  
  /* Placeholder text centering */
  &::placeholder {
    text-align: center;
    transform: translateY(-0.01em);
  }
}

/* Container-specific adjustments */
%round-container-center {
  /* For circular/rounded containers - text appears lower */
  transform: translateY(-0.06em);
}

%rectangular-container-center {
  /* For rectangular containers - standard centering */
  transform: translateY(-0.02em);
}

/* Font loading and fallback management */
@supports (font-family: 'Handwritten') {
  .osp {
    font-family: 'Handwritten', cursive !important;
  }
}

/* Cursor helper classes for JS toggles */
.cs-cursor-pointer { cursor: pointer !important; }
.cs-cursor-text { cursor: text !important; }

/* XP progress width via CSS variable */
.xp-progress { --xp-progress-width: 0%; }
.xp-progress { --xp-progress-color: rgba(112, 66, 21, 0.8); }
.xp-progress .xp-progress-fill { width: var(--xp-progress-width); transition: width 0.3s ease; background-color: var(--xp-progress-color, rgba(112, 66, 21, 0.8)); }

/* Combat stat boxes */
.cs-combat-stats { display: flex; gap: 1.5rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }
.cs-combat-stat { display: flex; flex-direction: column; align-items: center; }
.cs-combat-input {
  @extend %input-visual-center;
  @extend %visual-center-medium;
  @extend %numeric-center;
  
  width: 80px;
  height: 40px;
  font-size: 1.2rem;
  border: 2px solid #4a5568;
  border-radius: 8px;
  background-color: white;
}

/* Combat tab background - Default (Generic) */
.tab[data-tab="combat"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-generic.webp') !important;
  background-size: contain, contain !important;
  background-position: top center, left 280px !important;
  background-repeat: no-repeat, no-repeat !important;
  background-attachment: scroll, scroll !important;
  background-color: transparent !important;
  height: 400px !important;
}

/* Skill target variants - Class takes priority over race */
/* Class-based variants */
.skill-layout-assassin .tab[data-tab="combat"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-assassin.webp') !important;
  min-height: 380px !important;
  max-height: 400px !important;
}

.skill-layout-barbarian .tab[data-tab="combat"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-barbarian.webp') !important;
  min-height: 450px !important;
  max-height: 470px !important;
}

.skill-layout-thief .tab[data-tab="combat"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-thief.webp') !important;
  min-height: 390px !important;
  max-height: 410px !important;
}

/* Race-based variants (only applied if no qualifying class) */
.skill-layout-dwarf .tab[data-tab="combat"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-dwarf.webp') !important;
  min-height: 420px !important;
  max-height: 440px !important;
}

.skill-layout-gnome .tab[data-tab="combat"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-gnome.webp') !important;
  min-height: 360px !important;
  max-height: 380px !important;
}

.skill-layout-halforc .tab[data-tab="combat"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-halforc.webp') !important;
  min-height: 480px !important;
  max-height: 500px !important;
}

.skill-layout-hobbit .tab[data-tab="combat"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-hobbit.webp') !important;
  min-height: 350px !important;
  max-height: 370px !important;
}

/* Special race + class combinations */
.skill-layout-dwarf-thief .tab[data-tab="combat"] {
  background-image: url('/systems/osp-houserules/assets/character-sheet/abilities-saves.webp'), url('/systems/osp-houserules/assets/character-sheet/skill-targets-dwarf-thief.webp') !important;
  /*min-height: 435px !important;
  max-height: 475px !important;*/
  height: 420px !important;
}

.cs-unarmored-box { width: 80px; height: 40px; text-align: center; font-size: 1.2rem; border: 2px solid #4a5568; border-radius: 8px; display: flex; align-items: center; justify-content: center; background-color: white; }

/* Save badge system */
.combat-section {
  position: relative;
  width: 100%;
  /*height: 400px; /* Set a height to contain the absolutely positioned saves */
}

.cs-save-group { 
  position: absolute; 
  display: inline-block; 
  margin: 0;
}

/* Individual save positioning - customize these left coordinates as needed */
.save-group-death { 
  --save-left: 12px; 
}

.save-group-wands { 
  --save-left: 139px; 
}

.save-group-paralysis { 
  --save-left: 262px; 
}

.save-group-breath { 
  --save-left: 390px; 
}

.save-group-spells { 
  --save-left: 516px;
}
.cs-save-value {
  @extend %visual-center-large;
  @extend %single-character-center;
  @extend %round-container-center;
  
  font-size: 100px !important;
  font-family: 'Handwritten', cursive !important;
  color: #704214 !important;
}

/* Misc helpers for textareas in bio */
.cs-bio-textarea { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 3px; resize: vertical; font-family: inherit; background-color: white; }

/* Encumbrance bar helpers */
.encumbrance-section .encumbrance-bar-container { position: relative; }
.encumbrance-section .encumbrance-bar { height: 12px; background: #22c55e; transition: width 0.3s ease; }
.encumbrance-section .encumbrance-bar { width: var(--encumbrance-width, 0%); }

/* Level progress helpers */
.cs-level-progress-bar { 
    position: absolute; 
    top: 0; 
    left: 0; 
    height: 100%; 
    border-radius: 3px; 
    background-color: rgba(112, 66, 21, 0.8); 
    width: 0%; 
    transition: width 0.3s ease; 
}

.cs-level-display {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  width: 61px;
  height: 32px;
  font-size: 34px;
  color: #704214;
  z-index: var(--z-level, -10);
  font-family: 'Handwritten', cursive;
  background: transparent !important;
  box-shadow: none !important;
}

/* Portrait helpers - configurable dimensions via CSS variables */
.cs-portrait-container { 
  position: absolute; 
  width: 134px !important; /* Fixed width - more reliable than CSS variables */
  height: 138px !important; /* Fixed height - more reliable than CSS variables */
  overflow: hidden; 
}
.cs-portrait-display,
.portrait-display { 
  position: absolute; 
  top: 0; 
  left: 0; 
  width: 100%; 
  height: 100%; 
  cursor: pointer; 
  border-radius: 3px; 
  overflow: hidden; 
  pointer-events: auto; 
}
.cs-portrait-img,
.portrait-img { 
  /* Default size: fit within container while maintaining aspect ratio */
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  display: block; 
  /* Player can resize and reposition from this starting size */
}

/* XP/Next level small field helpers */
.cs-field {
  @extend %input-visual-center;
  @extend %visual-center-medium;
  
  background-color: transparent !important;
  border: none;
  box-shadow: none !important;
  appearance: none;
  margin: 0;
  color: inherit;
  padding: 0 2px 0 2px;
}
.cs-xp-mod-display {
  @extend %visual-center-medium;
  @extend %numeric-center;
  @extend %rectangular-container-center;
  
  align-items: center;
  justify-content: center;
  text-align: center;
  width: 60px;
  height: 32px;
  pointer-events: none;
  font-size: 34px;
  color: #704214 !important;
}

.cs-xp-display {
  @extend %visual-center-medium;
  @extend %numeric-center;
  @extend %input-visual-center;
  
  width: 130px;
  height: 32px;
  cursor: pointer;
  pointer-events: auto;
  font-size: 34px;
  color: #704214 !important;
}
/* Next Level field class moved below - see .cs-next-level-field for independent control */

/* Ensure inputs behave consistently across browsers with visual centering */
input.cs-field, 
textarea.cs-bio-textarea, 
select.cs-ability-select {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  
  /* Apply visual centering to all form elements */
  @extend %input-visual-center;
}

/* Additional browser-specific centering fixes */
input[type="text"], 
input[type="number"], 
select {
  /* WebKit browsers need extra centering help */
  &::-webkit-input-placeholder {
    text-align: center;
    line-height: normal;
  }
  
  /* Firefox placeholder centering */
  &::-moz-placeholder {
    text-align: center;
    line-height: normal;
  }
  
  /* Edge/IE placeholder centering */
  &::-ms-input-placeholder {
    text-align: center;
    line-height: normal;
  }
}

/* Visual centering for specific input types */
input[type="number"] {
  @extend %numeric-center;
  
  /* Remove spinner arrows that affect visual centering */
  &::-webkit-outer-spin-button,
  &::-webkit-inner-spin-button {
    -webkit-appearance: none;
    appearance: none;
    margin: 0;
  }
  
  /* Firefox number input styling */
  -moz-appearance: textfield;
  appearance: textfield;
}

/* ================================================================
   MANUAL FINE-TUNING UTILITY CLASSES
   ================================================================
   
   These classes can be applied when the automatic visual centering
   needs adjustment for specific elements or edge cases.
   
   ================================================================ */

/* Vertical adjustment utilities */
.cs-center-nudge-up-xs { transform: translateY(-0.01em) !important; }
.cs-center-nudge-up-sm { transform: translateY(-0.02em) !important; }
.cs-center-nudge-up-md { transform: translateY(-0.04em) !important; }
.cs-center-nudge-up-lg { transform: translateY(-0.06em) !important; }
.cs-center-nudge-up-xl { transform: translateY(-0.08em) !important; }

.cs-center-nudge-down-xs { transform: translateY(0.01em) !important; }
.cs-center-nudge-down-sm { transform: translateY(0.02em) !important; }
.cs-center-nudge-down-md { transform: translateY(0.04em) !important; }
.cs-center-nudge-down-lg { transform: translateY(0.06em) !important; }
.cs-center-nudge-down-xl { transform: translateY(0.08em) !important; }

/* Horizontal adjustment utilities */
.cs-center-nudge-left-xs { text-indent: -0.01em !important; }
.cs-center-nudge-left-sm { text-indent: -0.02em !important; }
.cs-center-nudge-left-md { text-indent: -0.04em !important; }

.cs-center-nudge-right-xs { text-indent: 0.01em !important; }
.cs-center-nudge-right-sm { text-indent: 0.02em !important; }
.cs-center-nudge-right-md { text-indent: 0.04em !important; }

/* Letter spacing adjustments for visual centering */
.cs-letter-spacing-tight { letter-spacing: -0.02em !important; }
.cs-letter-spacing-normal { letter-spacing: 0 !important; }
.cs-letter-spacing-loose { letter-spacing: 0.02em !important; }

/* Font weight adjustments that affect visual centering */
.cs-visual-weight-light { font-weight: 300 !important; transform: translateY(-0.01em) !important; }
.cs-visual-weight-normal { font-weight: 400 !important; }
.cs-visual-weight-bold { font-weight: 600 !important; transform: translateY(0.01em) !important; }

/* Character-specific centering adjustments */
.cs-percentage-center {
  /* Percentage signs need slight left adjustment */
  text-indent: -0.01em;
  transform: translateY(-0.02em);
}

.cs-plus-sign-center {
  /* Plus signs in XP modifiers need adjustment */
  text-indent: -0.005em;
  transform: translateY(-0.03em);
}

/* Add more custom classes as needed */
.cs-number-only-center {
  /* For fields that only contain single numbers */
  transform: translateY(-0.02em) !important;
  font-variant-numeric: tabular-nums !important;
}

.cs-mixed-alphanumeric-center {
  /* Mixed content like "+10%" needs balanced centering */
  text-indent: -0.008em;
  transform: translateY(-0.025em);
}

/* Disable visual centering for elements that need manual control */
.cs-manual-center {
  transform: none !important;
  text-indent: 0 !important;
  letter-spacing: inherit !important;
}

/* Header field classes (name, class, race, small fields) */
.cs-char-field-group { display: flex; flex-direction: column; align-items: center; margin-bottom: -5px; }
.cs-char-name {
  @extend %input-visual-center;
  @extend %visual-center-medium;
  
  width: 271px;
  height: 31px;
  font-family: 'Handwritten', cursive;
  font-size: 34px;
  color: #704214 !important;
  background-color: transparent !important;
  box-shadow: none !important;
  appearance: none;
  margin: 0;
  overflow: visible;
  white-space: nowrap;
  text-overflow: clip;
  border: none;
  pointer-events: auto;
  padding: 0 2px 0 2px;
}
.cs-class-select {
  /* Removed conflicting @extend mixins - using manual centering instead */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  
  width: 130px;
  height: 31px;
  font-size: 34px;
  color: #704214 !important;
  background-color: transparent !important;
  box-shadow: none !important;
  appearance: none;
  margin: 0;
  border: none;
  pointer-events: auto;
  padding: 0 2px 0 2px;
}

/* Background field - separate class for independent control */
.cs-background-select {
  /* Inherit base layout from large selects but allow independent styling */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  line-height: 1;
  box-sizing: border-box;
  
  /* Size and positioning */
  width: 128px;
  height: 32px;
  
  /* Typography - uses CSS variable from JavaScript for dynamic sizing */
  font-size: var(--background-font-size, 24px);
  font-family: 'Handwritten', cursive;
  font-weight: normal;
  letter-spacing: 0;
  color: #704214 !important;
  
  /* Appearance */
  background-color: transparent !important;
  color: inherit;
  border: none;
  box-shadow: none !important;
  appearance: none;
  outline: none;
  
  /* Layout */
  margin: 0;
  padding: 0 5px 0 5px;
  
  /* Interaction */
  pointer-events: auto;
  cursor: pointer;
  
  /* Visual centering */
  vertical-align: middle;
  
  /* Focus states - customize as needed */
  &:focus {
    outline: none;
  }
  
  /* Disabled states */
  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
}

/* Race field - separate class for independent control */
.cs-race-select {
  /* Inherit base layout from large selects but allow independent styling */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  line-height: 1;
  box-sizing: border-box;
  
  /* Size and positioning */
  width: 130px;
  height: 32px;
  
  /* Typography - customize as needed */
  font-size: 34px;
  font-family: 'Handwritten', cursive;
  color: #704214 !important;
  font-weight: normal;
  letter-spacing: 0;
  
  /* Appearance */
  background-color: transparent !important;
  color: inherit;
  border: none;
  box-shadow: none !important;
  appearance: none;
  outline: none;
  
  /* Layout */
  margin: 0;
  padding: 0 5px 0 5px;
  
  /* Interaction */
  pointer-events: auto;
  cursor: pointer;
  
  /* Focus states - customize as needed */
  &:focus {
    outline: none;
  }
  
  /* Disabled states (for race-as-class synchronization) */
  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    background-color: rgba(0, 0, 0, 0.05) !important;
  }
}

/* Next Level field - separate class for independent control */
.cs-next-level-field {
  /* Inherit base layout but allow independent styling */
  @extend %visual-center-medium;
  @extend %numeric-center;
  @extend %rectangular-container-center;
  /*display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;*/
  
  /* Size and positioning */
  width: 129px;
  height: 32px;
  
  /* Typography - customize as needed */
  font-size: 34px;
  font-family: 'Handwritten', cursive;
  font-weight: normal;
  letter-spacing: 0;
  color: #704214 !important;
  
  /* Appearance */
  background-color: transparent !important;
  color: inherit;
  border: none;
  box-shadow: none !important;
  appearance: none;
  outline: none;
  
  /* Layout */
  margin: 0;
  padding: 2px 0 0 2px;
  
  /* Interaction - readonly field */
  pointer-events: none;
  cursor: default;
  user-select: none;
  
  /* Numeric formatting */
  font-variant-numeric: tabular-nums;
  
  /* Focus states - not applicable for readonly */
  &:focus {
    outline: none;
  }
  
  /* Custom styling for calculated values */
  &[readonly] {
    background-color: transparent !important;
    color: inherit;
  }
}

/* Next Level container with XP progress bar */
.next-level-group {
  position: relative;
  width: 134px;
  height: 34px;
  
  /* XP Progress bar within Next Level field */
  .level-xp-progress {
    position: absolute;
    top: 0px;
    left: 0px;
    height: 33px;
    width: var(--level-height, 0%);
    background: var(--level-bg, linear-gradient(to right, rgba(112, 66, 21, 0.2) 0%, rgba(112, 66, 21, 0.2) 100%));
    transition: width 0.3s ease;
    z-index: 1;
    border-radius: 3px;
    overflow: hidden;
  }
  
  /* Next Level display sits on top of progress bar */
  .cs-next-level-field {
    position: relative;
    z-index: 2;
  }
}

/* Alignment field - separate class for independent control */
.cs-alignment-select {
  /* Inherit base layout from large selects but allow independent styling */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  line-height: 1;
  box-sizing: border-box;
  
  /* Size and positioning */
  width: 128px;
  height: 32px;
  
  /* Typography - customize as needed */
  font-size: 34px;
  font-family: 'Handwritten', cursive;
  font-weight: normal;
  letter-spacing: 0;
  color: #704214 !important;
  
  /* Appearance */
  background-color: transparent !important;
  color: inherit;
  border: none;
  box-shadow: none !important;
  appearance: none;
  outline: none;
  
  /* Layout */
  margin: 0;
  padding: 0 5px 0 5px;
  
  /* Interaction */
  pointer-events: auto;
  cursor: pointer;
  
  /* Visual centering */
  vertical-align: middle;
  
  /* Focus states - customize as needed */
  &:focus {
    outline: none;
  }
}

/* Height field - separate class for independent control */
.cs-height-field {
  /* Inherit base layout but allow independent styling */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  
  /* Size and positioning */
  width: 65px;
  height: 32px;
  
  /* Typography - customize as needed */
  font-size: 34px;
  font-family: 'Handwritten', cursive;
  letter-spacing: 0;
  color: #704214 !important;
  
  /* Appearance */
  background-color: transparent !important;
  color: inherit;
  border: none;
  box-shadow: none !important;
  appearance: none;
  outline: none;
  
  /* Layout */
  margin: 0;
  padding: 0 2px 0 2px;
  
  /* Interaction */
  pointer-events: auto;
  cursor: text;
  
  /* Visual centering for measurements */
  vertical-align: middle;
  
  /* Focus states */
  &:focus {
    outline: none;
  }
  
  /* Input styling for physical measurements */
  &::placeholder {
    color: #704214;
    font-style: italic;
  }
}

/* Weight field - separate class for independent control */
.cs-weight-field {
  /* Inherit base layout but allow independent styling */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  line-height: 1;
  box-sizing: border-box;
  
  /* Size and positioning */
  width: 66px;
  height: 32px;
  
  /* Typography - customize as needed */
  font-size: 34px;
  font-family: 'Handwritten', cursive;
  letter-spacing: 0;
  color: #704214 !important;
  
  /* Appearance */
  background-color: transparent !important;
  color: inherit;
  border: none;
  box-shadow: none !important;
  appearance: none;
  outline: none;
  
  /* Layout */
  margin: 0;
  padding: 0 2px 0 2px;
  
  /* Interaction */
  pointer-events: auto;
  cursor: text;
  
  /* Visual centering for measurements */
  vertical-align: middle;
  
  /* Focus states */
  &:focus {
    outline: none;
  }
  
  /* Input styling for physical measurements */
  &::placeholder {
    color: #704214;
    font-style: italic;
  }
}

/* Languages field - separate class for independent control */
.cs-languages-field {
  /* Container for language tags display */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  
  /* Size and positioning - uses CSS variables from existing system */
  width: 267px;
  height: 32px;
  
  /* Typography - uses CSS variables for dynamic control */
  font-size: var(--languages-font-size, 24px);
  font-family: 'Handwritten', cursive;
  font-weight: normal;
  letter-spacing: var(--languages-letter-spacing, 0px);
  line-height: var(--languages-line-height, 1);
  color: #704214 !important;
  
  /* Appearance */
  background: transparent !important;
  color: #704214 !important;
  border: none !important;
  box-shadow: none !important;
  
  /* Layout */
  margin: 0;
  padding: 2px 3px 2px 3px;
  
  /* Interaction */
  pointer-events: auto;
  cursor: pointer;
  user-select: none;
  
  /* Visual centering - Y-axis positioning adjustment */
  vertical-align: middle;
}

/* Age field - separate class for independent control */
.cs-age-field {
  /* Inherit base layout but allow independent styling */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  color: #704214 !important;
  
  /* Size and positioning - compact field for age */
  width: 61px;
  height: 32px;
  
  /* Typography - Age field with Handwritten font */
  font-family: 'Handwritten', cursive !important;
  font-size: 34px;
  color: #704214;

    /* Appearance */
  background-color: transparent !important;
  color: inherit;
  border: none;
  box-shadow: none !important;
  appearance: none;
  outline: none;
  
  /* Visual centering - Y-axis positioning adjustment */
  vertical-align: middle;
}

/* Sex field - separate class for independent control */
.cs-sex-field {
  /* Inherit base layout but allow independent styling */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  color: #704214 !important;

  /* Size and positioning - compact dropdown for sex */
  width: 61px;
  height: 32px;
  
  /* Typography - Sex field with Handwritten font */
  font-family: 'Handwritten', cursive !important;
  font-size: 34px;
  color: #704214;
  
  /* Appearance */
  background-color: transparent !important;
  border: none;
  color: inherit;
  box-shadow: none !important;
  appearance: none;
  outline: none;
  cursor: pointer;
  
  /* Remove default select styling */
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  
  /* Visual centering - Y-axis positioning adjustment */
  vertical-align: middle;
  
  /* Option styling */
  option {
    font-family: 'Handwritten', cursive;
    font-size: 16px;
    color: #704214;
    background-color: #ffffff;
  }
}

/* Keep this partial focused on presentation only; behavior remains in JS. */

/* Absolute-position helper using CSS variables set inline on elements */
.cs-abs {
  position: absolute !important;
  left: var(--left, auto);
  top: var(--top, auto);
  right: var(--right, auto);
  bottom: var(--bottom, auto);
  z-index: var(--z, auto) !important;
  pointer-events: var(--pointer, auto);
  height: var(--height, auto);
  background: var(--bg, transparent);
}

/* Draggable field helpers */
.draggable-field {
  position: relative !important;
  cursor: move !important;
  user-select: none !important;
  --translate-x: 0px;
  --translate-y: 0px;
  transform: translate(var(--translate-x), var(--translate-y));
}
.draggable-field.dragging { z-index: var(--z-overlay, 1000) !important; opacity: 0.8 !important; }
.draggable-field .drag-handle { position: absolute; top: 2px; right: 2px; font-size: 12px; color: #666; cursor: move; opacity: 0.6; z-index: var(--z-sheet,10); pointer-events: auto; font-weight: bold; text-shadow: 1px 1px 1px rgba(255,255,255,0.8); background: rgba(255,255,255,0.9); border: 1px solid #ccc; border-radius: 2px; padding: 1px 2px; line-height: 1; width: 14px; height: 14px; display: flex; align-items: center; justify-content: center; }
.draggable-field.drag-hover { border-color: #ddd !important; }
.draggable-field.drag-hover .drag-handle { opacity: 1 !important; }

/* Drag handle visibility class toggled by JS instead of inline opacity */
.draggable-field .drag-handle { transition: opacity 0.12s ease; }
.draggable-field .drag-handle.visible { opacity: 1 !important; }

/* Layout controls (export/import/reset grid buttons) */
.layout-controls { position: absolute; top: 5px; right: 5px; z-index: calc(var(--z-overlay, 1000) + 1); display: flex; gap: 5px; }
.layout-controls .layout-btn { width: 24px; height: 24px; border: none; border-radius: 3px; background: #4a5568; color: white; font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.layout-controls .layout-btn:hover { filter: brightness(1.1); }
.layout-controls .layout-btn.active { background: #2d3748 !important; }

/* Grid overlay - uses CSS variables for grid size */
.grid-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: calc(var(--z-overlay, 1000) - 1);
  background-image: linear-gradient(rgba(0,0,0,0.08) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.08) 1px, transparent 1px);
  background-size: var(--grid-size, 10px) var(--grid-size, 10px);
}

/* Sheet body helper to centralize padding/scrolling */
.cs-sheet-body {
  position: absolute !important;
  top: var(--sheet-top, 230px);
  left: 0;
  right: 0;
  bottom: 0;
  padding: 1px 3.6px 2px 4px;
  /* overflow-y: auto; */
}

/* Generic small field label */
.cs-field-label { margin-bottom: 0.5rem; font-size: 1.1rem; }

/* Languages row and tags reset for consistent layout */
.languages-row.open-language-dialog { width: var(--languages-row-width, 272px); height: 33px; min-height: 30px; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 2px; z-index: var(--z-lang-row, 101); }
.languages-tags { 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  width: 100%; 
  line-height: 0.6;
  white-space: wrap; /* Allow wrapping when needed */
  overflow: hidden; 
  font-size: var(--languages-font-size, 24px) !important;
  padding: 0 4px;
  font-family: 'Handwritten', cursive !important;
  color: #704214 !important;
  text-align: center;
  word-wrap: break-word; /* Allow breaking long words if needed */
  
  /* When not empty, ensure our font size applies - higher specificity */
  &:not(:empty) {
    font-size: var(--languages-font-size, 24px) !important;
  }
}

/* Bio content wrapper */
.bio-content { padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }

/* Position presets (centralize numeric offsets) */
.cs-pos-level { --left: #{$cs-pos-level-left}; --top: #{$cs-pos-level-top}; --z: var(--z-level, 8); }
.cs-pos-portrait { --left: #{$cs-pos-portrait-left}; --top: #{$cs-pos-portrait-top}; --z: var(--z-portrait, 15); }
.cs-pos-languages { --left: #{$cs-pos-languages-left}; --top: #{$cs-pos-languages-top}; --z: var(--z-labels, 15); --pointer: auto; }
.cs-pos-xpmod { --left: #{$cs-pos-xpmod-left}; --top: #{$cs-pos-xpmod-top}; --z: var(--z-labels, 15); }
.cs-pos-xp { --left: #{$cs-pos-xp-left}; --top: #{$cs-pos-xp-top}; --z: var(--z-portrait, 15); }
.cs-pos-next { --left: #{$cs-pos-next-left}; --top: #{$cs-pos-next-top}; --z: var(--z-labels, 15); }
.cs-pos-sep { --bottom: 0; --left: 0; --right: 0; --height: 1px; --bg: transparent; --z: var(--z-labels, 15); }

/* Header / small-field presets discovered during the sweep */
.cs-pos-namegroup { --left: #{$cs-pos-namegroup-left}; --top: #{$cs-pos-namegroup-top}; --z: var(--z-labels, 15); }
.cs-pos-class { --left: #{$cs-pos-class-left}; --top: #{$cs-pos-class-top}; --z: var(--z-labels, 15); }
.cs-pos-alignment { --left: #{$cs-pos-alignment-left}; --top: #{$cs-pos-alignment-top}; --z: var(--z-labels, 15); }
.cs-pos-race { --left: #{$cs-pos-race-left}; --top: #{$cs-pos-race-top}; --z: var(--z-labels, 15); }
.cs-pos-age { --left: #{$cs-pos-age-left}; --top: #{$cs-pos-age-top}; --z: var(--z-labels, 15); }
.cs-pos-sex { --left: #{$cs-pos-sex-left}; --top: #{$cs-pos-sex-top}; --z: var(--z-labels, 15); }
.cs-pos-height { --left: #{$cs-pos-height-left}; --top: #{$cs-pos-height-top}; --z: var(--z-labels, 15); }
.cs-pos-weight { --left: #{$cs-pos-weight-left}; --top: #{$cs-pos-weight-top}; --z: var(--z-labels, 15); }
.cs-pos-background { --left: #{$cs-pos-background-left}; --top: #{$cs-pos-background-top}; --z: var(--z-labels, 15); }
.cs-pos-listening { --left: #{$cs-pos-listening-left}; --top: #{$cs-pos-listening-top}; --width: #{$cs-pos-listening-width}; --height: #{$cs-pos-listening-height}; --z: var(--z-labels, 15); }

/* Universal Save Positioning - Simplified System */
.cs-save {
  position: absolute !important;
  left: var(--save-left, 0px) !important;
  top: var(--save-top, 131px) !important;
  width: var(--save-width, 65px) !important;
  height: var(--save-height, 87px) !important;
  z-index: var(--z-labels, 15) !important;
}

/* Universal Ability Score Positioning - Simplified System */
/* Individual abilities are positioned via inline CSS custom properties like: */
/* style="--ability-left: 150px; --ability-top: 52px; --ability-width: 65px; --ability-height: 87px;" */
.cs-ability {
  position: absolute !important;
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  margin: 0 !important;
  left: var(--ability-left, 0px);
  top: var(--ability-top, 40px) !important;
  width: var(--ability-width, 86px) !important;
  height: var(--ability-height, 66px) !important;
  z-index: var(--z-labels, 15) !important;
  pointer-events: auto !important;
}

/* Small helpers found useful during migration */
.cs-tab-relative { position: relative; }
.cs-bio-heading { margin: 0 0 0.5rem 0; padding-bottom: 0.25rem; border-bottom: 1px solid #ccc; font-size: 1.1em; }
